è®¾è®¡å¥½é¡µé¢å¯¼èˆªä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹é€æ­¥å®ç°æ¯ä¸ªé¡µé¢äº†ã€‚æˆ‘å°†ç”¨ä¸¤è®²çš„ç¯‡å¹…å®ç°**ä¸ªäººèµ„æ–™è®¾ç½®é¡µ**ä»¥åŠ**æŒä¹…åŒ–æ•°æ®å­˜å‚¨**èƒ½åŠ›ã€‚

å…·ä½“æ¥è¯´ï¼Œå½“ç¨‹åºå¯åŠ¨åï¼Œè‹¥æ£€æµ‹åˆ°å°šæœªé…ç½®ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ™åº”è·³è½¬åˆ°ä¸ªäººèµ„æ–™è®¾ç½®é¡µã€‚åˆ¤æ–­çš„ä¾æ®ä¾¿æ˜¯ç”¨æˆ·åæ˜¯å¦å­˜åœ¨ï¼Œè€Œâ€œå­˜åœ¨â€çš„æ ‡å‡†åˆ™æ˜¯è·å–åˆ°çš„å€¼æ—¢ä¸æ˜¯ nullï¼Œä¹Ÿä¸æ˜¯ç©ºå­—ç¬¦ä¸²ï¼ˆâ€œâ€ï¼‰ã€‚è¿™éƒ¨åˆ†çš„æ•°æ®å­˜å‚¨å°†ä½¿ç”¨é¦–é€‰é¡¹ï¼ˆShared Preferencesï¼‰æ¥å®ç°ã€‚è¿™æ˜¯æœ¬è®²çš„å†…å®¹ã€‚

æ¥ç€ï¼Œå¯¹äºæ—¥è®°çš„å­˜å‚¨ï¼Œå…¶æ•°æ®é‡å°†éšç€ä½¿ç”¨é¢‘ç‡çš„å¢åŠ æ—¥ç›Šå¢å¤šï¼Œä¸”ç”¨æˆ·è¿˜å¯èƒ½ä»¥ä¸åŒçš„æ¡ä»¶è¿›è¡ŒæŸ¥è¯¢ã€‚æ˜¾ç„¶ï¼Œä½¿ç”¨æ•°æ®åº“åˆ™æ›´åŠ åˆé€‚ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘è¿˜ä¼šä»‹ç» json æ ¼å¼ä»¥åŠå¦‚ä½•å°† json æ ¼å¼çš„å­—ç¬¦ä¸²ä¸æ•°æ®åº“ç›¸ç»“åˆä½¿ç”¨çš„æ–¹æ³•ã€‚

æœ€åï¼ŒFlutter æœ€å¸¸ç”¨çš„æ•°æ®åº“åŒ…å¹¶ä¸é€‚ç”¨äº PC ç­‰ç”µè„‘è®¾å¤‡ï¼Œæˆ‘è¿˜ä¼šä»‹ç»å…¼å®¹å¤šå¹³å°è®¾å¤‡çš„è§£å†³æ–¹æ¡ˆã€‚è¿™éƒ½æ˜¯ä¸‹ä¸€è®²çš„å†…å®¹ã€‚

æ€»çš„æ¥è¯´ï¼Œå†…å®¹ä¸å°‘ï¼Œå¹²è´§ç‰¹åˆ«å¤šï¼ˆæ‰€ä»¥æˆ‘æŠŠå®ƒä»¬æ‹†æˆäº†ä¸¤è®²ï¼‰ã€‚å¤§å®¶åŠ¡å¿…æ‰“èµ·åäºŒåˆ†çš„ç²¾ç¥ï¼Œè·Ÿå¥½æˆ‘çš„æ€è·¯ï¼Œæœ€åå°†æ”¶è·é¢‡ä¸°ã€‚

## ä¸ªäººèµ„æ–™é¡µé¢ UI

è®¾ç½®ä¸ªäººèµ„æ–™é¡µï¼ˆapp_configuration.dartï¼‰å…¶å®éå¸¸ç®€å•ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘è¿™é‡Œä»…è¦æ±‚ç”¨æˆ·å¡«å†™åå­—ã€‚ç„¶åå†æ·»åŠ ä¸€ä¸ªâ€œç»§ç»­â€æŒ‰é’®ï¼Œç”¨æ¥ç¡®è®¤ï¼Œå¹¶è·³è½¬åˆ°ä¸‹ä¸€æ­¥ã€‚å…·ä½“æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9d8dc767ba5b4b429983ba7375182ba4~tplv-k3u1fbpfcp-zoom-1.image)

å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œ**å½“ç”¨æˆ·æ²¡æœ‰å¡«å†™åå­—ç›´æ¥ç‚¹å‡»ç»§ç»­æŒ‰é’®æ—¶ï¼Œå°†å¼¹å‡ºæç¤ºæ¡†**ï¼Œæç¤ºç”¨æˆ·åå­—æ˜¯å¿…å¡«é¡¹ã€‚æ­¤å¤–ï¼Œç†Ÿæ‚‰ iOS è¾“å…¥é£æ ¼çš„æœ‹å‹çŸ¥é“ï¼Œ**å½“ç”¨æˆ·ç‚¹å‡»ç©ºç™½å¤„ï¼Œå¼¹å‡ºçš„é”®ç›˜åº”è¯¥è‡ªåŠ¨æ”¶èµ·**ã€‚å¦‚æœ**ç”¨æˆ·å¡«å†™äº†åå­—ï¼Œå†ç‚¹å‡»ç»§ç»­æ—¶ï¼Œç¨‹åºä¼šä¿å­˜ç”¨æˆ·çš„åå­—åˆ°é¦–é€‰é¡¹ï¼Œç„¶åè·³è½¬åˆ°ä¸»é¡µé¢**ã€‚

ä»¥ä¸Šä¾¿æ˜¯æ•´ä¸ªäº¤äº’è¿‡ç¨‹äº†ï¼Œè®©æˆ‘ä»¬é€ä¸ªâ€œå‡»ç ´â€å®ƒä»¬ã€‚

## æ§ä»¶çš„é€‰æ‹©ä¸æ‘†æ”¾

é¦–å…ˆï¼Œè®©æˆ‘ä»¬å…ˆæŠŠæ‰€éœ€è¦çš„æ§ä»¶éƒ½æ‘†æ”¾å¥½ã€‚è¾“å…¥æ¡†ç”¨ CupertinoTextFieldï¼Œç»§ç»­æŒ‰é’®ç”¨CupertinoButtonã€‚é¡¶éƒ¨çš„å¯¼èˆªæ åˆ™æ˜¯ CupertinoNavigationBarã€‚

`ğŸ’¡ æç¤ºï¼šä¸ºä»€ä¹ˆæˆ‘ä¼šæƒ³åˆ°ä½¿ç”¨è¿™äº›æ§ä»¶å‘¢ï¼Ÿè¿™é‡Œé¢å…¶å®æœ‰ä¸€ä¸ªè§„å¾‹ï¼šæ™®é€šçš„è¾“å…¥æ¡†æ˜¯ TextFieldï¼ŒæŒ‰é’®æ˜¯ Buttonï¼ŒFlutter å®˜æ–¹æä¾›çš„ iOS é£æ ¼æ§ä»¶é€šå¸¸åªéœ€åœ¨å…¶å‰é¢åŠ ä¸Š Cupertino å‰ç¼€å³å¯ã€‚`

ç›¸åº”ä»£ç å¦‚ä¸‹ï¼š

```
 // èµ„æ–™å¡«å†™åŒºåŸŸ
Widget _buildInputForm() {
  return CupertinoTextField(
      placeholder: "æ‚¨çš„åå­—",
      keyboardType: TextInputType.name,
      )ï¼›
}
// åº•éƒ¨ç¡®è®¤æŒ‰é’®
Widget _buildConfirmButton() {
  return CupertinoButton(
      child: const Text("ç»§ç»­"),
      onPressed: () {
        // ä¿å­˜èµ„æ–™åˆ°é¦–é€‰é¡¹ï¼Œå¹¶è·³è½¬åˆ°ä¸»é¡µ
      });
}
@override
Widget build(BuildContext context) {
  return CupertinoPageScaffold(
    navigationBar: const CupertinoNavigationBar(
      middle: Text("ä¸ªäººèµ„æ–™é…ç½®"),
    ),
    child: SafeArea(
      child: Container(
        margin: const EdgeInsets.all(50),
        child: Column(
          children: [
            Expanded(
                child: Center(
              child: _buildInputForm(),
            )),
            _buildConfirmButton()
          ],
        ),
      ),
    ),
  );
}
```

è¦å……åˆ†ç†è§£è¿™æ®µä»£ç ï¼Œå…ˆä» build() æ–¹æ³•å¼€å§‹ã€‚

CupertinoPageScaffold å¯¹åº” Scaffoldï¼Œä¸ºæˆ‘ä»¬æä¾›äº†æ„å»º iOS é£æ ¼é¡µé¢çš„**è„šæ‰‹æ¶**ã€‚

navigationBar æ˜¯é¡¶éƒ¨çš„**å¯¼èˆªæ **ï¼Œé€šå¸¸ä½¿ç”¨ CupertinoNavigationBar å¯¹è±¡èµ‹å€¼ã€‚é™¤äº† middle å±æ€§å¤–ï¼Œè¿˜æä¾› leadingã€automaticallyImplyLeadingã€backgroundColor ç­‰å±æ€§ï¼Œè¡¨ç¤ºæ˜¯å¦è‡ªåŠ¨ç”Ÿæˆå·¦ä¾§æ§ä»¶ï¼ˆé»˜è®¤æ˜¯è¿”å›æ“ä½œï¼‰ã€èƒŒæ™¯é¢œè‰²ç­‰ï¼Œè¿™é‡Œå°±ä¸å†ä¸€ä¸€èµ˜è¿°äº†ï¼Œå¤§å®¶å¯ä»¥é€šè¿‡æŒ‰é”®ç›˜ä¸Šçš„ Ctrl+é¼ æ ‡å·¦é”®ç‚¹å‡» CupertinoNavigationBar æŸ¥çœ‹æºç ï¼Œå°±èƒ½ä¸€ç›®äº†ç„¶äº†ã€‚

è‡³äºè„šæ‰‹æ¶ä¸­çš„å­ç»„ä»¶ childï¼Œæˆ‘é¦–å…ˆä½¿ç”¨äº† SafeAreaã€‚å®ƒçš„ä½œç”¨æ˜¯**ä½¿é¡µé¢çš„å†…å®¹éƒ¨åˆ†é¡¶éƒ¨å¤„äºå¯¼èˆªæ çš„ä¸‹é¢**ã€‚å¦‚æœæ²¡æœ‰ SafeAreaï¼Œå¤§å®¶å¯ä»¥è¯•ç€ç›´æ¥æ”¾ä¸€ä¸ª Text ç»„ä»¶è¿›å»ï¼Œé¡µé¢ä¸ä¼šæœ‰ä»»ä½•æ˜¾ç¤ºã€‚ä½†å®é™…ä¸Šæ˜¯é¡¶éƒ¨çš„å¯¼èˆªæ æŒ¡ä½äº† Text ç»„ä»¶ã€‚

åœ¨ SafeArea ç»„ä»¶ä¸­ï¼Œæˆ‘ä½¿ç”¨äº† Column å­ç»„ä»¶ï¼Œå°†è¾“å…¥æ¡†å’ŒæŒ‰é’®åŒ…å«åœ¨å…¶ä¸­ã€‚**Expanded çš„ä½œç”¨æ˜¯ä½¿å…¶å­ç»„ä»¶å……æ»¡å±å¹•çš„å‰©ä½™ç©ºé—´**ã€‚ä¸‹å›¾ç›´è§‚åœ°æ˜¾ç¤ºäº† Column å†…éƒ¨ç»„ä»¶çš„å…³ç³»ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1542a0f7544148d0840828237108b416~tplv-k3u1fbpfcp-zoom-1.image)

å›¾ä¸­é»‘è‰²è¾¹æ¡†è¡¨ç¤ºçš„åŒºåŸŸå°±æ˜¯æ•´ä¸ª Column ç»„ä»¶äº†ã€‚ç»¿è‰²éƒ¨åˆ†è¡¨ç¤º Expanded ç»„ä»¶ï¼Œè“è‰²éƒ¨åˆ†è¡¨ç¤º _buildConfirmButton() æ–¹æ³•è¿”å›çš„ç»„ä»¶ï¼Œå³ CupertinoButtonã€‚

ä¸ºäº†å¢å¼ºä»£ç çš„å¯è¯»æ€§å’Œæ˜“ç»´æŠ¤æ€§ï¼Œæˆ‘æŠŠä¸Šè¿°ä¸¤éƒ¨åˆ†çš„ç»„ä»¶åˆ†åˆ«ä½¿ç”¨ _buildInputForm() å’Œ _buildConfirmButton() æ–¹æ³•è¿›è¡Œäº†å°è£…ã€‚

å¥½äº†ï¼Œé¡µé¢ UI å¸ƒå±€åˆ°æ­¤å·²ç»å¯ä»¥åŸºæœ¬å®£å‘Šç»“æŸäº†ã€‚æ¥ç€ï¼Œæˆ‘ä»¬è¦å®ç°çš„åŠŸèƒ½å°±æ˜¯å¦‚ä½•è·å–ç”¨æˆ·è¾“å…¥çš„æ–‡å­—äº†ã€‚

## æ–‡æœ¬è¾“å…¥æ¡†çš„å†…å®¹å–å€¼å’Œèµ‹å€¼

è™½ç„¶æˆ‘ä»¬åªæƒ³è·å–è¾“å…¥æ¡†çš„æ–‡å­—ï¼Œä½†ä¸å¦¨æŠŠçœ¼å…‰å†æ”¾å¾—é•¿è¿œäº›ï¼šå³ç„¶èƒ½å–å€¼ï¼Œå¯å¦èµ‹å€¼å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚

æœ‰äººå¯èƒ½ä¼šé—®ï¼šä»€ä¹ˆæ—¶å€™éœ€è¦ç»™è¾“å…¥æ¡†èµ‹å€¼å‘¢ï¼Ÿæƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨ä½¿ç”¨æ‰‹æœºé€šè®¯å½•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸ä»…å¯ä»¥æ–°å»ºè”ç³»äººï¼Œè¿˜å¯ä»¥ç¼–è¾‘è”ç³»äººã€‚åœ¨ç¼–è¾‘è”ç³»äººçš„æ—¶å€™ï¼Œå·²ç»å­˜å‚¨çš„ä¿¡æ¯ä¼šé»˜è®¤æ˜¾ç¤ºåˆ°ç›¸åº”çš„è¾“å…¥æ¡†ä¸­ï¼Œä¾¿äºä¿®æ”¹ã€‚è¿™ä¾¿æ˜¯ç»™è¾“å…¥æ¡†èµ‹å€¼çš„ä»·å€¼ä½“ç°ä¹‹ä¸€ã€‚

æ— è®ºæ˜¯ TextField è¿˜æ˜¯ CupertinoTextFieldï¼Œéƒ½åŒ…å«å¾ˆå¤šå±æ€§ã€‚åœ¨ä¸çŸ¥é“å¦‚ä½•è·å–è¾“å…¥å†…å®¹çš„æ—¶å€™ï¼Œä¸å¦¨å…ˆçœ‹çœ‹æºç ä¸­çš„æ³¨é‡Šã€‚å¾ˆå¿«ä¾¿å‘ç°äº† controller ä¼¼ä¹å¾ˆæœ‰ç”¨ï¼Œå…³äºå®ƒçš„æ³¨é‡Šå’Œä»£ç æ˜¯è¿™æ ·çš„ï¼š

> */// The [controller] can also control the selection and composing region (and to* */// observe changes to the text, selection, and composing region).*
>
> ...
>
> */// If null, this widget will create its own [TextEditingController].* *final* TextEditingController? controller;

æ„æ€å°±æ˜¯ **controller å¯ä»¥ç›‘è§†æ–‡æœ¬ã€é€‰æ‹©ä»¥åŠç¼–è¾‘åŒºåŸŸçš„æ”¹å˜ä»¥åŠæ§åˆ¶å®ƒä»¬ã€‚è¯¥å±æ€§éœ€è¦ TextEditingController å¯¹è±¡è¿›è¡Œèµ‹å€¼**ã€‚

äºæ˜¯ï¼Œå›åˆ° app_configuration.dartï¼Œåˆ›å»ºä¸€ä¸ª TextEditingController å¯¹è±¡ï¼Œç„¶åèµ‹å€¼ç»™ controller å±æ€§ã€‚æˆ‘ä»¬å°±è¿™æ ·è¯•è¯•çœ‹ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Œä»£ç å¦‚ä¸‹ï¼š

```
final TextEditingController _nameInputController = TextEditingController();
// èµ„æ–™å¡«å†™åŒºåŸŸ
Widget _buildInputForm() {
  return CupertinoTextField(
    placeholder: "æ‚¨çš„åå­—",
    keyboardType: TextInputType.name,
    controller: _nameInputController,
  );
}
```

æ‰§è¡Œçƒ­åŠ è½½ï¼Œå‘ç°ç•Œé¢å¹¶æ²¡æœ‰ä»€ä¹ˆå˜åŒ–ã€‚åˆ«æ€¥ï¼Œç»§ç»­æ·±å…¥ç ”ç©¶ä¸€ä¸‹ TextEditingControllerï¼Œä¼šå‘ç°å¯ä»¥è·å–å®ƒçš„ text å˜é‡ï¼Œå…³äº text çš„è§£é‡Šä¹Ÿå¯ä»¥åœ¨ TextEditingController çš„æºç ä¸­æ‰¾åˆ°ï¼š

> */// This constructor treats a null [text] argument as if it were the empty* */// string.*
>
> ...
>
> */// The current string the user is editing.* String *get* text => value.text; */// Setting this will notify all the listeners of this [TextEditingController]* */// that they need to update (it calls [notifyListeners]). For this reason,* */// this value should only be set between frames, e.g. in response to user* */// actions, not during the build, layout, or paint phases.* *///* */// This property can be set from a listener added to this* */// [TextEditingController]; however, one should not also set [selection]* */// in a separate statement. To change both the [text] and the [selection]* */// change the controller's [value].* *set* text(String newText) { value = value.copyWith( text: newText, selection: *const* TextSelection.collapsed(offset: -1), composing: TextRange.*empty*, ); }

å¤§æ¦‚æ„æ€æ˜¯ **text è¡¨ç¤ºç”¨æˆ·æ­£åœ¨ç¼–è¾‘çš„æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œå¼€å‘è€…æ—¢å¯ä»¥é€šè¿‡å®ƒè·å–ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™å®ƒï¼Œä½¿è¾“å…¥æ¡†ä¸­çš„å†…å®¹å‘ç”Ÿå˜åŒ–**ã€‚

å¥½äº†ï¼Œåˆ°è¿™é‡Œï¼Œç›¸ä¿¡å¤§å®¶å·²ç»æœ‰è±ç„¶å¼€æœ—ä¹‹æ„Ÿã€‚

å›é¡¾æ•´ä¸ªæ€è€ƒè¿‡ç¨‹ï¼Œå…¶å®æˆ‘ä»¬å”¯ä¸€å€ŸåŠ©çš„å‚è€ƒèµ„æ–™ä¾¿æ˜¯ä»£ç æœ¬èº«ã€‚å®é™…ä¸Šï¼Œä¸åªæ˜¯ Flutterã€‚å¯é ã€æˆç†Ÿçš„ä»£ç ä¸€èˆ¬éƒ½ä¼šæœ‰å¾ˆå®Œå–„çš„æ³¨é‡Šï¼Œéå¸¸è¯¦å°½åœ°é˜è¿°äº†å®ƒä»¬çš„ä½¿ç”¨æ–¹æ³•ã€‚ä½œä¸ºè°ƒç”¨è€…ï¼Œè¿™äº›æ³¨é‡Šå°±æ˜¯ç¬¬ä¸€æ‰‹ææ–™ï¼Œæ¯”ä¼ ç»Ÿçš„å›¾ä¹¦ã€ç½‘ä¸Šæœæ¥çš„æ–¹æ³•æ›´é è°±ã€‚

æœ‰äº†æ€è·¯ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å®ç°äº†ã€‚

è·å–ç”¨æˆ·è¾“å…¥å†…å®¹çš„é€»è¾‘åœ¨ç”¨æˆ·ç‚¹å‡»ç»§ç»­æŒ‰é’®åå‘ç”Ÿï¼Œæ‰€ä»¥ï¼Œå›åˆ°æŒ‰é’®çš„å®ç°ï¼Œå¹¶å®Œå–„åç»­çš„ä»£ç ï¼š

```
 // åº•éƒ¨ç¡®è®¤æŒ‰é’®
Widget _buildConfirmButton() {
  return CupertinoButton(
      child: const Text("ç»§ç»­"),
      onPressed: () {
        // ä¿å­˜èµ„æ–™åˆ°é¦–é€‰é¡¹ï¼Œå¹¶è·³è½¬åˆ°ä¸»é¡µ
_saveToSharedPref();
      });
}
void _saveToSharedPref() async {
  var name = _nameInputController.text;
  // ç©ºå­—ç¬¦ä¸²åˆ¤æ–­
 if (name == "") {
    showCupertinoDialog(
      context: context,
      builder: (context) {
        return CupertinoAlertDialog(
          title: const Text("è¯·æ£€æŸ¥"),
          content: const Text("è¯·å¡«å†™æ‚¨çš„åå­—"),
          actions: [
            CupertinoDialogAction(
              child: const Text("ç¡®å®š"),
              onPressed: () {
                Navigator.of(context).pop();
              },
            ),
          ],
        );
      },
    );
  } else {
    // ä¿å­˜èµ„æ–™åˆ°é¦–é€‰é¡¹
    // è·³è½¬åˆ°ä¸»é¡µ
router.navigateTo(context, Routes.indexPage, clearStack: true);
  }
}
```

_saveToSharedPref() æ–¹æ³•å°è£…äº†ä¿å­˜ç”¨æˆ·åå­—åˆ°é¦–é€‰é¡¹ã€é¡µé¢è·³è½¬ä»¥åŠç”¨æˆ·è¾“å…¥ä¸ºç©ºæ—¶çš„åˆ¤æ–­ã€‚æ­¤å¤„å½“ç”¨æˆ·è¾“å…¥ä¸ºç©ºå­—ç¬¦ä¸²ï¼ˆâ€œâ€ï¼‰æ—¶ï¼Œå¼¹å‡ºå¯¹è¯æ¡†æç¤ºç”¨æˆ·æ£€æŸ¥å¿…å¡«é¡¹ã€‚ç”¨åˆ°çš„æ–¹æ³•æ˜¯å†…ç½®çš„ showCupertinoDialog()ï¼Œè¯¥æ–¹æ³•ç”¨èµ·æ¥ååˆ†å®¹æ˜“ï¼Œå¤§å®¶è‡ªè¡Œé˜…è¯»ä»£ç è¿›è¡Œäº†è§£ï¼Œæˆ‘å°±ä¸å†å±•å¼€è®²äº†ã€‚

å®Œæˆç¼–ç åï¼Œæ‰§è¡Œçƒ­åŠ è½½ã€‚å°è¯•åœ¨è¾“å…¥æ¡†ä¸­è¾“å…¥ä¸€äº›æ–‡å­—æˆ–ä¸è¾“å…¥ï¼Œç„¶åç‚¹å‡»ä¸‹é¢çš„ç»§ç»­æŒ‰é’®ã€‚å¦‚æ— æ„å¤–ï¼Œè§‚å¯Ÿé¡µé¢çš„å˜åŒ–ï¼Œåº”è¯¥æ˜¯ç¬¦åˆé¢„æœŸçš„ã€‚

åˆ«æ€¥ï¼è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦å®ç°ï¼š**ç‚¹å‡»ç©ºç™½å¤„æ”¶èµ·è½¯é”®ç›˜**ã€‚

- è¯´åˆ°â€œç‚¹å‡»â€ï¼Œå¤§å®¶ä¼šæƒ³åˆ°ä»€ä¹ˆï¼Ÿ**æ‰‹åŠ¿**ï¼æ‰‹åŠ¿åŒ…å«äº†ç‚¹å‡»ã€åŒå‡»ã€æ‹–æ‹½ç­‰ç­‰ï¼›
- è¯´åˆ°â€œç©ºç™½å¤„â€ï¼Œå°±æ˜¯èƒ½**äº§ç”Ÿäº’åŠ¨å¤–çš„æ‰€æœ‰åŒºåŸŸ**ï¼›
- è¯´åˆ°â€œæ”¶èµ·è½¯é”®ç›˜â€ï¼Œä¸å¦¨å…ˆå€’è¿‡æ¥æƒ³ï¼šè½¯é”®ç›˜å‡ºç°çš„æ—¶æœºæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯è¾“å…¥æ¡†è·å¾—äº†**ç„¦ç‚¹**ï¼é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æŠŠç„¦ç‚¹æ”¾åœ¨éè¾“å…¥æ¡†åŒºåŸŸï¼Œæ˜¯ä¸æ˜¯å°±å¯ä»¥æ”¶èµ·é”®ç›˜äº†å‘¢ï¼Ÿ

å¤šè¯´æ— ç›Šï¼Œä¸å¦¨è¯•è¯•ã€‚æˆ‘åœ¨æ•´ä¸ª CupertinoPageScaffold ç»„ä»¶å¤–ï¼Œå†å¥—ä¸€ä¸ªæ‰‹åŠ¿å¤„ç†ç»„ä»¶ GestureDetectorï¼Œå¹¶ä¸º onTap å±æ€§èµ‹å€¼ï¼Œè¯¥å±æ€§å°±æ˜¯ç‚¹å‡»æ—¶çš„å¤„ç†ï¼Œä»£ç å¦‚ä¸‹ï¼š

```
@override
Widget build(BuildContext context) {
  return GestureDetector(
    onTap: () {
      FocusScope.of(context).requestFocus(FocusNode());
    },
    child: CupertinoPageScaffold(
    ...
    ),
  );
}
```

å¥½äº†ï¼Œå†è¯•è¯•çœ‹ã€‚å½“æˆ‘ä»¬ç‚¹å‡»è¾“å…¥æ¡†ï¼Œå†ç‚¹å‡»ç©ºç™½å¤„æ—¶ï¼Œæ˜¯ä¸æ˜¯è½¯é”®ç›˜ä¹–ä¹–åœ°æ”¶èµ·æ¥äº†ï¼Ÿ

æå®šäº†æ‰€æœ‰é¡µé¢äº¤äº’ï¼Œæˆ‘ä»¬ç»ˆäºæ¥åˆ°äº†é¦–é€‰é¡¹ IO çš„å®ç°éƒ¨åˆ†ã€‚

## é¦–é€‰é¡¹ IO

è¯´åˆ°é¦–é€‰é¡¹ï¼Œå…¶å®æ˜¯å¤§éƒ¨åˆ†ç¨‹åºéƒ½å¿…ä¸å¯å°‘çš„èƒ½åŠ›ã€‚å…¸å‹çš„ä½¿ç”¨åœºæ™¯é™¤äº†åƒæœ¬ä¾‹è¿™æ ·ä¿å­˜ç”¨æˆ·åå­—å¤–ï¼Œè¿˜æœ‰ä¿å­˜ç¨‹åºè®¾ç½®çš„å€¼ã€‚æ¯”å¦‚æ˜¯å¦ä¿å­˜å¯†ç ã€æ˜¯å¦è‡ªåŠ¨ç™»å½•ã€æ˜¯å¦å…è®¸æµé‡ä¸‹è½½ç­‰ç­‰ï¼Œå¯ä»¥è¯´æ˜¯åº”ç”¨å¾—éå¸¸å¹¿æ³›äº†ã€‚

æ— è®ºä½¿ç”¨åœºæ™¯å¦‚ä½•ï¼Œå…¶**æœ¬è´¨å°±æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ª key - value è¿™æ ·çš„é”®å€¼å¯¹æ„æˆ**çš„ã€‚æ¯”å¦‚æœ¬ä¾‹ä¸­çš„ç”¨æˆ·åï¼Œè‹¥ç”¨æˆ·è¾“å…¥çš„æ˜¯ Adaï¼Œç¨‹åºä¸­å®šä¹‰çš„é”®æ˜¯ usernameï¼Œä¿å­˜åçš„é”®å€¼å…³ç³»å°±æ˜¯ username - Adaã€‚

ä½œä¸ºå¼€å‘è€…ï¼Œå¯ä»¥**é€šè¿‡é”®å­˜å€¼å’Œå–å€¼**ï¼Œè¿™ç§å­˜å’Œå–çš„è¿‡ç¨‹ï¼Œå°±æ˜¯é¦–é€‰é¡¹ IO çš„è¿‡ç¨‹äº†ã€‚

ç„¶è€Œï¼ŒFlutter æ¡†æ¶è‡ªèº«å…¶å®å¹¶æ²¡æœ‰æä¾›é¦–é€‰é¡¹ IO çš„èƒ½åŠ›ï¼Œéœ€è¦é›†æˆåŒ…æ¥å®ç°ã€‚åŒ…çš„åç§°æ˜¯ **shared_preferences**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Package ç½‘ç«™ä¸Šæœç´¢æ‰¾åˆ°å®ƒï¼šhttps://pub.flutter-io.cn/packages/shared_preferencesã€‚

é€šè¿‡é˜…è¯»ç½‘ç«™ä¸Šçš„æ–‡æ¡£ï¼Œå¯ä»¥å‘ç°é¦–é€‰é¡¹ä¸ä»…å¯ä»¥ç”¨äºæ‰‹æœºå®¢æˆ·ç«¯ï¼Œè¿˜å¯ä»¥ç”¨äºç”µè„‘ç«¯å’Œ Web ç«¯ï¼Œä¸ºæ„å»ºè·¨å¹³å°åº”ç”¨ç¨‹åºæä¾›äº†å……è¶³çš„æ”¯æŒã€‚

ä¸‹é¢ï¼Œæ¥åˆ° pubspec.yamlï¼Œé›†æˆå®ƒå§ï¼

```
dependencies:
  flutter:
    sdk: flutter

  ...
  # é¦–é€‰é¡¹å­˜å‚¨
shared_preferences: ^2.0.15
```

`ğŸ’¡ æç¤ºï¼šå¤§å®¶åœ¨é›†æˆçš„æ—¶å€™ï¼Œä¸è¦ç…§æŠ„ç‰ˆæœ¬å·ã€‚éšç€æ—¶é—´çš„æ¨ç§»ï¼Œå¯èƒ½ä¼šæœ‰æ›´æ–°çš„ç‰ˆæœ¬å‘å¸ƒï¼Œè¯·å¤§å®¶å‚è€ƒ Package ç½‘ç«™ä¸­çš„ç‰ˆæœ¬è¿›è¡Œé›†æˆã€‚`

å…³äº shared_preferences åº“çš„ç”¨æ³•ï¼Œå…¶å®ç½‘ç«™ä¸Šå·²ç»æœ‰éå¸¸è¯¦ç»†çš„ç¤ºä¾‹äº†ã€‚æˆ‘æŠŠæˆ‘çš„å®ç°æ”¾åœ¨è¿™é‡Œï¼Œä¸»è¦æ˜¯ä½¿ç”¨äº†å•ä¾‹æ¨¡å¼ï¼Œä¾›å¤§å®¶å‚è€ƒä½¿ç”¨ï¼š

```
import 'package:shared_preferences/shared_preferences.dart';
class SharedPrefUtil {
  SharedPrefUtil._privateConstructor();
  static  final SharedPrefUtil _instance = SharedPrefUtil._privateConstructor();
  static SharedPrefUtil get instance {
    return _instance;
  }
  /// ä¿å­˜ç”¨æˆ·å
saveUsername(String username) async {
    SharedPreferences prefs = await SharedPreferences.getInstance();
    await prefs.setString("username", username);
  }
  /// è¯»å–ä¿å­˜çš„ç”¨æˆ·å
readUsername() async {
    SharedPreferences prefs = await SharedPreferences.getInstance();
    String? name = prefs.getString("username");
    return name;
  }
}
```

è¿™æ®µä»£ç è‡ªæˆä¸€ä¸ªæ–‡ä»¶ï¼Œä½äºå·¥ç¨‹ä¸­ lib\util\shared_pref_util.dartã€‚util æ„ä¸ºå·¥å…·ï¼Œåœ¨è¿™ä¸ªç›®å½•ä¸‹çš„æºç æ–‡ä»¶éƒ½å°†ä½œä¸ºå·¥å…·ç±»ä½¿ç”¨ã€‚

å®Œæˆç¼–ç åï¼Œå›åˆ° app_configuration.dartï¼Œç»§ç»­å®Œå–„ _saveToSharedPref() æ–¹æ³•ï¼š

```
void _saveToSharedPref() async {
  var name = _nameInputController.text;
  // ç©ºå­—ç¬¦ä¸²åˆ¤æ–­
 if (name == "") {
    showCupertinoDialog(
      context: context,
      builder: (context) {
        return CupertinoAlertDialog(
          title: const Text("è¯·æ£€æŸ¥"),
          content: const Text("è¯·å¡«å†™æ‚¨çš„åå­—"),
          actions: [
            CupertinoDialogAction(
              child: const Text("ç¡®å®š"),
              onPressed: () {
                Navigator.of(context).pop();
              },
            ),
          ],
        );
      },
    );
  } else {
    // ä¿å­˜èµ„æ–™åˆ°é¦–é€‰é¡¹
SharedPrefUtil.instance.saveUsername(name);
    // è·³è½¬åˆ°ä¸»é¡µ
router.navigateTo(context, Routes.indexPage, clearStack: true);
  }
}
```

ç»“æŸäº†å—ï¼Ÿè¿˜æ²¡æœ‰ã€‚

å›æƒ³ä¸€ä¸‹ï¼Œèµ„æ–™é…ç½®é¡µé¢æ˜¯å¦‚ä½•è·³å‡ºæ¥çš„ï¼Ÿæ˜¯åœ¨ä¸»é¡µé¢åšäº†åˆ¤æ–­åæ‰è·³è½¬çš„ï¼è€Œåˆ¤æ–­çš„ä¾æ®è¿˜æ˜¯é¦–é€‰é¡¹ä¸­çš„ç”¨æˆ·åå­—æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å›åˆ° main.dartï¼Œåœ¨ _jumpToAppConfig() æ–¹æ³•ä¸­è·å–ä¿å­˜æ•°æ®ï¼Œå†æ ¹æ®è·å–åˆ°çš„ç»“æœè¿›è¡Œè·³è½¬æˆ–æ˜¾ç¤ºæ¬¢è¿ä½¿ç”¨å¯¹è¯æ¡†ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c6ea64c838944a5ade5ab5682506794~tplv-k3u1fbpfcp-zoom-1.image)

ä»£ç å¦‚ä¸‹ï¼š

```
_jumpToAppConfig() async {
  username = await SharedPrefUtil.instance.readUsername();
  if (username == null || username == "") {
    router.navigateTo(context, Routes.appConfigurationPage, clearStack: true);
  } else {
    showCupertinoDialog(
      context: context,
      builder: (context) {
        return CupertinoAlertDialog(
          title: const Text("æ¬¢è¿ä½¿ç”¨"),
          content: Text(username!),
          actions: [
            CupertinoDialogAction(
              child: const Text("ç¡®å®š"),
              onPressed: () {
                Navigator.of(context).pop();
              },
            ),
          ],
        );
      },
    );
  }
}
```

å¥½äº†ï¼Œæ•´ä¸ªç¼–ç åˆ°æ­¤å°±ç»“æŸäº†ã€‚

å¦‚æœä½ ç¼–å†™çš„ä»£ç æ— æ³•å®ç°æœ¬è®²æ‰€è¿°çš„åŠŸèƒ½ï¼Œæœ«å°¾çš„é™„å½•å¯èƒ½ä¼šå¸®åˆ°ä½ ã€‚

## **æ€»ç»“**

ğŸ‰ æ­å–œï¼Œæ‚¨å®Œæˆäº†æœ¬æ¬¡è¯¾ç¨‹çš„å­¦ä¹ ï¼

ğŸ“Œ ä»¥ä¸‹æ˜¯æœ¬æ¬¡è¯¾ç¨‹çš„é‡ç‚¹å†…å®¹æ€»ç»“ï¼š

æœ¬è®²ä»‹ç»äº†èµ„æ–™é…ç½®é¡µé¢çš„ UI äº¤äº’å’ŒåŠŸèƒ½å®ç°ã€‚

åœ¨ UI äº¤äº’éƒ¨åˆ†ï¼Œé‡ç‚¹åœ¨**å¦‚ä½•ä¸è¾“å…¥æ¡†äº¤äº’ï¼Œè¿›è¡Œå–å€¼å’Œèµ‹å€¼**ã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸¤ä¸ªç»éªŒç±»çš„å°æŠ€å·§ï¼š**SafeArea** çš„ä½¿ç”¨ï¼Œä»¥åŠä½¿ç”¨ **Expanded** ç»„ä»¶å¯¹å±å¹•æœªä½¿ç”¨çš„åŒºåŸŸè¿›è¡Œå¡«å……ã€‚

åŠŸèƒ½æ–¹é¢ä¸»è¦ä»‹ç»äº†å¦‚ä½•é›†æˆå’Œä½¿ç”¨ **shared_preferences** åŒ…è¿›è¡Œé¦–é€‰é¡¹å­˜å–ã€‚

å¤§å®¶åœ¨å­¦ä¹ çš„æ—¶å€™ï¼Œåˆ‡å‹¿å®Œå…¨ç…§æ¬ã€‚ä¸€å®šè¦é¢†ä¼šå…¶ä¸­çš„æ–¹æ³•ï¼Œå­¦ä¹ è§£å†³é—®é¢˜çš„æ€è·¯ã€‚

â¡ï¸ åœ¨ä¸‹æ¬¡è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šç»§ç»­ã€Šæ—¥è®°ã€‹ç¨‹åºçš„å¼€å‘ï¼Œå…·ä½“å†…å®¹æ˜¯ï¼š

-   æœ¬åœ°æŒä¹…åŒ–çš„å®ç°ï¼Œæœ¬åœ°æ•°æ®åº“ï¼ˆSQLiteï¼‰çš„è®¾è®¡ã€å®ç°ä¸å°è£…ã€‚

## é™„å½•1ï¼šmain.dart å®Œæ•´ä»£ç ï¼š

```
import 'package:diary/router/routes.dart';
import 'package:diary/ui/index/index.dart';
import 'package:diary/util/shared_pref_util.dart';
import 'package:fluro/fluro.dart';
import 'package:flutter/cupertino.dart';
final router = FluroRouter();
void main() {
  // é…ç½®è·¯ç”±
Routes.configureRoutes(router);
  runApp(const MyApp());
}
class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);
  @override
  Widget build(BuildContext context) {
    return CupertinoApp(onGenerateRoute: router.generator, home: const Diary());
  }
}
class Diary extends StatefulWidget {
  const Diary({Key? key}) : super(key: key);
  @override
  State<Diary> createState() => _DiaryState();
}
class _DiaryState extends State<Diary> {
  String? username;
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addPostFrameCallback((_) {
      // æœªè¿›è¡Œèµ„æ–™é…ç½®ï¼Œè·³è½¬åˆ°ç›¸åº”é¡µé¢è¿›è¡Œ
_jumpToAppConfig();
    });
  }
  _jumpToAppConfig() async {
    username = await SharedPrefUtil.instance.readUsername();
    if (username == null || username == "") {
      router.navigateTo(context, Routes.appConfigurationPage, clearStack: true);
    } else {
      showCupertinoDialog(
        context: context,
        builder: (context) {
          return CupertinoAlertDialog(
            title: const Text("æ¬¢è¿"),
            content: Text(username!),
            actions: [
              CupertinoDialogAction(
                child: const Text("ç¡®å®š"),
                onPressed: () {
                  Navigator.of(context).pop();
                },
              ),
            ],
          );
        },
      );
    }
  }
  @override
  Widget build(BuildContext context) {
    return  const IndexPage();
  }
}
```

## é™„å½•2ï¼šapp_configuration.dart å®Œæ•´ä»£ç ï¼š

```
import 'package:diary/util/shared_pref_util.dart';
import 'package:flutter/cupertino.dart';
import '../../main.dart';
import '../../router/routes.dart';
class AppConfigurationPage extends StatefulWidget {
  const AppConfigurationPage({Key? key}) : super(key: key);
  @override
  State<AppConfigurationPage> createState() => _AppConfigurationPageState();
}
class _AppConfigurationPageState extends State<AppConfigurationPage> {
  final TextEditingController _nameInputController = TextEditingController();
  // èµ„æ–™å¡«å†™åŒºåŸŸ
Widget _buildInputForm() {
    return CupertinoTextField(
      placeholder: "æ‚¨çš„åå­—",
      keyboardType: TextInputType.name,
      controller: _nameInputController,
    );
  }
  // åº•éƒ¨ç¡®è®¤æŒ‰é’®
Widget _buildConfirmButton() {
    return CupertinoButton(
        child: const Text("ç»§ç»­"),
        onPressed: () {
          // ä¿å­˜èµ„æ–™åˆ°é¦–é€‰é¡¹ï¼Œå¹¶è·³è½¬åˆ°ä¸»é¡µ
_saveToSharedPref();
        });
  }
  void _saveToSharedPref() async {
    var name = _nameInputController.text;
    // ç©ºå­—ç¬¦ä¸²åˆ¤æ–­
 if (name == "") {
      showCupertinoDialog(
        context: context,
        builder: (context) {
          return CupertinoAlertDialog(
            title: const Text("è¯·æ£€æŸ¥"),
            content: const Text("è¯·å¡«å†™æ‚¨çš„åå­—"),
            actions: [
              CupertinoDialogAction(
                child: const Text("ç¡®å®š"),
                onPressed: () {
                  Navigator.of(context).pop();
                },
              ),
            ],
          );
        },
      );
    } else {
      // ä¿å­˜èµ„æ–™åˆ°é¦–é€‰é¡¹
SharedPrefUtil.instance.saveUsername(name);
      // è·³è½¬åˆ°ä¸»é¡µ
router.navigateTo(context, Routes.indexPage, clearStack: true);
    }
  }
  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTap: () {
        FocusScope.of(context).requestFocus(FocusNode());
      },
      child: CupertinoPageScaffold(
        navigationBar: const CupertinoNavigationBar(
          middle: Text("ä¸ªäººèµ„æ–™é…ç½®"),
        ),
        child: SafeArea(
          child: Container(
            margin: const EdgeInsets.all(50),
            child: Column(
              children: [
                Expanded(
                    child: Center(
                  child: _buildInputForm(),
                )),
                _buildConfirmButton()
              ],
            ),
          ),
        ),
      ),
    );
  }
}
```