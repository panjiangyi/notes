ä»Šå¤©ï¼Œæˆ‘ä»¬å†æ¬¡è®¨è®ºè‡ªå®šä¹‰ç»„ä»¶ã€‚å…ˆæ¥çœ‹è¿™æ ·ä¸€å¼ å›¾ï¼š

![df2d0ae9f43849799e5cbec7d81a23fdtplv-k3u1fbpfcp-watermark.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c38583cc1d41425ba020c2cee2ed8337~tplv-k3u1fbpfcp-watermark.image?)

æ²¡é”™ï¼Œè¿™å¼ å›¾å°±æ˜¯æœ¬æ¡ˆä¾‹ä¸»é¡µä¸­çš„â€œæ—¥å†â€é¡µã€‚

ç›¸ä¿¡åˆ°ä»Šå¤©ï¼Œåˆ†æ UI ç»“æ„çš„æŠ€èƒ½å¤§å®¶å·²ç»æŒæ¡å¾—å¾ˆå¥½äº†ã€‚ä»å®è§‚ä¸Šçœ‹ï¼Œæ•´ä¸ªç•Œé¢å‘ˆå‚ç›´å¸ƒå±€ï¼Œè‡ªä¸Šè€Œä¸‹åˆ†åˆ«æ˜¯æ—¥å†ç»„ä»¶å’Œæ—¥è®°åˆ—è¡¨ç»„ä»¶ã€‚åœ¨æ“ä½œä¸Šï¼Œè‹¥æŸå¤©å­˜åœ¨æ—¥è®°ï¼Œåˆ™åœ¨æ—¥å†ç»„ä»¶çš„ç›¸åº”ä½ç½®äº®è“ç¯ã€‚æ¯”å¦‚å›¾ä¸­çš„ 22 æ—¥ã€23 æ—¥å’Œ 24 æ—¥ã€‚æ­¤å¤–ï¼Œæ—¥å†å’Œæ—¥è®°åˆ—è¡¨ç»„ä»¶è”åŠ¨ï¼šä¸‹æ–¹çš„æ—¥è®°åˆ—è¡¨ä»…æ˜¾ç¤ºæ‰€é€‰æ—¥æœŸçš„æ—¥è®°ã€‚

å›é¡¾åœ¨è®²æ•°æ®åº“æ—¶ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†æ ¹æ®æ—¥æœŸæŸ¥è¯¢æ•°æ®çš„æ–¹æ³•ã€‚æ‰€ä»¥è”åŠ¨æ•°æ®éƒ¨åˆ†å®ç°èµ·æ¥è¾ƒä¸ºå®¹æ˜“ï¼Œæœ¬è®²ä¸å†è¯¦ç»†è®²è§£ï¼Œè¯»è€…å¯å‚è€ƒæœ¬è®²æœ«å°¾çš„é™„å½•éƒ¨åˆ†ä¸€æ¢ç©¶ç«Ÿã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠç›®å…‰èšç„¦åˆ°æ—¥å†ï¼Œé€æ­¥å®ç°è¿™ä¸ªç»„ä»¶ã€‚

åœ¨ Flutter ä¸­ï¼Œâ€œä¸€åˆ‡çš†ç»„ä»¶â€ï¼Œå†å¤æ‚çš„ç»„ä»¶ä¹Ÿä¸è¿‡æ˜¯åŸºç¡€ç»„ä»¶çš„æ’åˆ—ç»„åˆã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å…ˆå¯¹æ—¥å†ç»„ä»¶è¿›è¡ŒåŠŸèƒ½æ‹†è§£ï¼Œæ¢³ç†éœ€æ±‚ã€‚

## åŠŸèƒ½æ‹†è§£

ä½œä¸ºæ—¥å†ï¼Œæ­£ç¡®æ˜¾ç¤ºå½“å‰æ—¥æœŸæ˜¯å¿…é¡»çš„ã€‚ä»å›¾ä¸Šçœ‹ï¼Œå½“å‰æ—¥æœŸåŒ…å«ç»„ä»¶é¡¶æ çš„å¹´æœˆæ˜¾ç¤ºå’Œä¸‹æ–¹çš„æ—¥æœŸçŸ©é˜µã€‚å¦‚æœå†è¿›ä¸€æ­¥æ‹†è§£ï¼Œå¯ä»¥å‘ç°æ—¥å†ä¸­è¿˜å¡«å……äº†ä¸Šä¸ªæœˆå’Œ/æˆ–ä¸‹ä¸ªæœˆçš„æ—¥æœŸã€‚è™½ç„¶å®ƒä»¬æ˜¯ç°è‰²çš„ï¼Œä¸å¯ç‚¹å‡»ï¼Œä½†å®ƒä»¬ç¡®å®æ˜¯æ‘†åœ¨é‚£é‡Œçš„ï¼Œä¹Ÿéœ€è¦æˆ‘ä»¬å»å®ç°å®ƒã€‚å†æœ‰å°±æ˜¯è“ç¯æç¤ºã€‚ç»¼ä¸Šï¼Œæˆ‘æŠŠåŠŸèƒ½ç‚¹ç®€å•æ¢³ç†ç½—åˆ—å¦‚ä¸‹ï¼š

-   **é¡¶æ æ˜¾ç¤ºå½“å‰é€‰åŒºæ‰€å¤„çš„å¹´æœˆï¼Œå¹¶æä¾›ç›¸é‚»æœˆä»½åˆ‡æ¢åŠŸèƒ½ï¼›**
-   **é¡¶æ å’Œæ—¥æœŸçŸ©é˜µä¹‹é—´æ˜¾ç¤ºæ˜ŸæœŸï¼›**
-   **æ—¥æœŸæ˜¾ç¤ºçŸ©é˜µéœ€å¡«å……æœ¬æœˆæ‰€æœ‰çš„æ—¥æœŸï¼Œç©ºç™½éƒ¨åˆ†å¡«å……ç›¸é‚»æœˆä»½çš„æ—¥æœŸï¼›**
-   **æœ¬æœˆçš„æ—¥æœŸå¯ç‚¹å‡»ï¼Œå¯è·³è½¬ã€‚è‹¥å½“å¤©å«æœ‰æ—¥è®°ï¼Œåˆ™ä¸‹æ–¹ä»¥è“è‰²åœ†ç‚¹ï¼ˆå³â€œè“ç¯â€ï¼‰æ–¹å¼æç¤ºï¼›**
-   **ç›¸é‚»æœˆä»½çš„æ—¥æœŸæ˜¾ç¤ºä¸ºç°è‰²å­—ä½“ï¼Œä¸å¯ç‚¹å‡»ï¼Œä¸å¯è·³è½¬ï¼›**
-   **å½“å‰é€‰æ‹©çš„æ—¥æœŸçš„èƒŒæ™¯æ”¹ä¸ºè“è‰²ï¼Œåœ†å½¢ã€‚**

## ç®—æ³• & å®ç°

å¦‚åŒæˆ‘ä»¬åœ¨å»ºé€ ä¸€ä¸ªçŠ¬èˆå’Œæ‘©å¤©å¤§æ¥¼ä¸€æ ·ã€‚ç®€å•çš„çŠ¬èˆï¼Œå³ä½¿æ„å»ºå¤±è´¥ï¼Œé‡è¯•çš„æˆæœ¬å¾ˆä½ï¼Œè€Œä¸”ç®€å•ã€‚ä½†æ‘©å¤©å¤§æ¥¼å°±ä¸åŒäº†ï¼Œå®ƒçš„å¤±è´¥æˆæœ¬è¿œè¿œè¶…å‡ºä¸€ä¸ªçŠ¬èˆã€‚

åˆ°ç¼–ç¨‹ä¸Šä¹Ÿæ˜¯ç±»ä¼¼çš„ï¼Œå¯¹äºå¤æ‚çš„éœ€æ±‚ï¼Œæ²¡æœ‰è§„åˆ’ï¼Œè´¸ç„¶è¡ŒåŠ¨ï¼Œå…¶ç»“æœå¯èƒ½ä¼šé¢ä¸´å·¨å¤§çš„æˆæœ¬æ¶ˆè€—ã€‚

æ‰€ä»¥ï¼Œåœ¨åŠ¨æ‰‹ç¼–ç ä¹‹å‰ï¼Œç‰¹åˆ«æ˜¯è¿™ç§æ•°æ®å’Œ UI éƒ½éœ€è¦å¤„ç†çš„æ—¶å€™ï¼Œé€šå¸¸è¦å…ˆæœ‰ä¸ªè§„åˆ’ã€‚

`ğŸ’¡ æç¤ºï¼šå½“ç„¶ï¼Œæˆ‘åœ¨è¿™é‡Œæä¾›çš„ç®—æ³•ä»…æ˜¯è¯¸å¤šè§£å†³æ–¹æ¡ˆä¸­çš„ä¸€ç§ï¼Œè‚¯å®šè¿˜ä¼šæœ‰å…¶å®ƒæ›´å¥½çš„ç®—æ³•ã€‚å¤§å®¶å¦‚æœæœ‰ä»€ä¹ˆå¥½ç‚¹å­ï¼Œæ¬¢è¿ä¸€èµ·æ¢è®¨ã€‚`

ç›¸ä¿¡å¤§å®¶å’Œæˆ‘çš„æƒ³æ³•ä¸€æ ·ï¼Œæ•´ä¸ªç»„ä»¶æœ€éš¾å®ç°çš„ï¼Œè«è¿‡äºæ—¥æœŸçŸ©é˜µã€‚

æˆ‘çš„æ€è·¯æ˜¯è¿™æ ·çš„ï¼š**æ—¥æœŸçŸ©é˜µå…¶å®æ˜¯åŒ…å«ä¸‰ä¸ªéƒ¨åˆ†çš„æ—¥æœŸï¼šä¸Šä¸ªæœˆã€æœ¬æœˆã€ä¸‹ä¸ªæœˆã€‚å®ƒä»¬çš„åˆ†ç•Œçº¿å®é™…ä¸Šæ˜¯æœ¬æœˆ 1 æ—¥å’Œæœ€åä¸€å¤©**ã€‚æ¯”å¦‚ä¸‹å›¾ä¸­çš„æ—¥å†ï¼š


![697ad59c5759489bb1706f692dc84916tplv-k3u1fbpfcp-watermark.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cdbc5d2f2aa543acb53670529ce288bd~tplv-k3u1fbpfcp-watermark.image?)

-   **å¯¹äºæœ¬æœˆï¼Œé¦–å…ˆç¡®å®šæœ€å¼€å§‹ç¬¬ä¸€å¤©çš„æ‰€åœ¨ä½ç½®ï¼Œç„¶åè®©æ—¥æœŸå¾ªç¯åŠ  1ï¼Œä¾æ¬¡å¡«å……è¿›çŸ©é˜µã€‚ç›´åˆ°æœˆä»½å‘ç”Ÿæ”¹å˜ï¼ˆå³æœˆä»½ +1ï¼‰** ï¼›
-   **å¯¹äºä¸Šä¸ªæœˆï¼Œç”±äºå‘¨çš„å¼€å§‹æ˜¯å‘¨æ—¥ï¼Œå› æ­¤è®©æœ¬æœˆç¬¬ä¸€å¤©å¾ªç¯å‡ 1ï¼Œä¾æ¬¡å¡«å……è¿›çŸ©é˜µã€‚ç›´åˆ°é¦–ä¸ªå‘¨æ—¥çš„åˆ°æ¥**ï¼›
-   **å¯¹äºä¸‹ä¸ªæœˆï¼Œä¾ç„¶æ˜¯ç”±äºå‘¨çš„å¼€å§‹æ˜¯å‘¨æ—¥ï¼Œå› æ­¤è®©æœ¬æœˆçš„æœ€åä¸€å¤©å¾ªç¯åŠ  1ï¼Œä¾æ¬¡å¡«å……è¿›çŸ©é˜µã€‚ç›´åˆ°é¦–ä¸ªå‘¨å…­çš„åˆ°æ¥ã€‚**

åœ¨ Dart ä¸­ï¼Œ`DateTime`ä¸­çš„`add()`å’Œ`substract()`å¯ä»¥å®ç°å¢åŠ å’Œå‡å°‘å¤©æ•°çš„è¿ç®—ã€‚å½“ç»“æœè·³è½¬åˆ°ä¸‹ä¸ªæœˆæˆ–ä¸Šä¸ªæœˆæ—¶ï¼Œå¹´ä»½å’Œ/æˆ–æœˆä»½ä¼šè‡ªåŠ¨å¢åŠ æˆ–å‡å°‘ã€‚

æ‹¿ä¸Šå›¾ä¸¾ä¾‹ï¼Œåœ¨ 2023 å¹´ 12 æœˆ 1 æ—¥å‡ 1 å¤©ï¼Œæ—¶é—´å°†å˜ä¸º 2023 å¹´ 11 æœˆ 30 æ—¥ï¼›åœ¨ 2023 å¹´ 12 æœˆ 31 æ—¥åŠ  1 å¤©ï¼Œæ—¶é—´å°†å˜ä¸º 2024 å¹´ 1 æœˆ 1 æ—¥ã€‚

æ¥ç€ï¼Œç”±äºæ—¥æœŸçŸ©é˜µæ˜¯å®Œå…¨å¡«å……ï¼Œæ²¡æœ‰ç©ºç™½æ ¼çš„ï¼Œå› æ­¤**æ•´ä¸ªçŸ©é˜µå†…çš„å…ƒç´ ä¸ªæ•°ï¼ˆå³å¤©æ•°ï¼‰æ°å¥½æ˜¯ 7 çš„å€æ•°**ã€‚

çœ‹åˆ°è¿™ï¼Œæ•°æ®ä¸Šçš„ç®—æ³•å…¶å®å·²ç»å¯ä»¥ç¡®å®šä¸‹æ¥äº†ã€‚å¦‚æœç”¨ä»£ç å®ç°çš„è¯ï¼Œä¼šæ˜¯è¿™æ ·çš„ï¼š

```
List<DateTime> allDates() {
  List<DateTime> returnData = [];
  DateTime singleDate = DateTime(currentDate.year, currentDate.month, 1);
  int month = currentDate.month;
  List<DateTime> datesOfThisMonth = [];
  List<DateTime> dateData = [];
  // ä¸Šä¸ªæœˆæ—¥æœŸå¡«å……
  for (int i = 0; i < singleDate.weekday; i++) {
    dateData.add(singleDate.subtract(Duration(days: singleDate.weekday - i)));
    datesOfThisMonth.add(dateData[i]);
  }
  // æœ¬æœˆé¦–å¤©
  dateData.add(singleDate);
  // æœ¬æœˆæ—¥æœŸå¡«å……
  while (singleDate.month == month) {
    datesOfThisMonth.add(singleDate);
    dateData.add(singleDate.add(const Duration(days: 1)));
    singleDate = singleDate.add(const Duration(days: 1));
  }
  // ä¸‹æœˆæ—¥æœŸå¡«å……
  for (int i = 0; i < 7 - singleDate.weekday; i++) {
    dateData.add(singleDate.add(Duration(days: i)));
    datesOfThisMonth.add(singleDate[i]);
  }
  // æ±‡æ€»æ‰€æœ‰æ—¥æœŸ
  for (int i = 0; i < datesOfThisMonth.length; i++) {
    returnData.add(datesOfThisMonth[i]);
  }
  return returnData;
}
```

ä½†æ˜¯è¿™è¿˜ä¸å¤Ÿï¼Œç•Œé¢ä¸Šæ‘†æ”¾çš„æ˜¯ç»„ä»¶ï¼ˆWidgetï¼‰ï¼Œæ— æ³•ç›´æ¥æ‘†æ”¾ DateTimeã€‚è¿˜éœ€è¦å¯¹`allDates()`æ–¹æ³•è¿›è¡Œæ”¹è¿›ï¼ŒæŠŠè¿”å›å€¼çš„ç±»å‹ï¼š`List<DateTime>`æ”¹æˆ`List<Widget>`ã€‚

å…·ä½“ä»£ç å¦‚ä¸‹ï¼š

```
// è®¡ç®—å¹¶ç”Ÿæˆå•ä¸ªæ—¥æœŸç»„ä»¶
List<Widget> allDates() {
  int currentDay = currentDate.day;
  List<Widget> returnData = [];
  DateTime singleDate = DateTime(currentDate.year, currentDate.month, 1);
  int month = currentDate.month;
  List<Widget> datesOfThisMonth = [];
  List<DateTime> dateData = [];
  // ä¸Šä¸ªæœˆæ—¥æœŸå¡«å……
  for (int i = 0; i < singleDate.weekday; i++) {
    dateData.add(singleDate.subtract(Duration(days: singleDate.weekday - i)));
    datesOfThisMonth.add(
      Expanded(
        child: Container(
            alignment: Alignment.center,
            padding: const EdgeInsets.all(5),
            child: Column(
              mainAxisAlignment: MainAxisAlignment.spaceEvenly,
              mainAxisSize: MainAxisSize.max,
              children: [
                Text(
                  dateData[i].day.toString(),
                  style: const TextStyle(
                      fontSize: 15, color: CupertinoColors.inactiveGray),
                  textAlign: TextAlign.center,
                ),
                const SizedBox(height: 10)
              ],
            )),
      ),
    );
  }
  // æœ¬æœˆé¦–å¤©
  dateData.add(singleDate);
  // æœ¬æœˆæ—¥æœŸå¡«å……
  while (singleDate.month == month) {
    DateTime uniqueDate = singleDate;
    datesOfThisMonth.add(
      Expanded(
        child: CupertinoButton(
          padding: const EdgeInsets.all(0),
          child: Container(
              alignment: Alignment.center,
              padding: const EdgeInsets.all(5),
              child: CircleAvatar(
                backgroundColor: currentDay == singleDate.day
                    ? Consts.themeColor
                    : CupertinoColors.white,
                child: Column(
                  mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                  mainAxisSize: MainAxisSize.max,
                  children: [
                    Text(singleDate.day.toString(),
                        style: TextStyle(
                            fontSize: 15,
                            color: currentDay == singleDate.day
                                ? CupertinoColors.white
                                : CupertinoColors.black),
                        textAlign: TextAlign.center),
                    widget.markedDate.contains(uniqueDate) &&
                            currentDay != singleDate.day
                        ? diaryExistDot()
                        : const SizedBox(height: 4)
                  ],
                ),
              )),
          onPressed: () {
            setState(() {
              currentDate = uniqueDate;
            });
            widget.onDateChanged(currentDate);
          },
        ),
      ),
    );
    dateData.add(singleDate.add(const Duration(days: 1)));
    singleDate = singleDate.add(const Duration(days: 1));
  }
  // ä¸‹æœˆæ—¥æœŸå¡«å……
  for (int i = 0; i < 7 - singleDate.weekday; i++) {
    dateData.add(singleDate.add(Duration(days: i)));
    datesOfThisMonth.add(
      Expanded(
        child: Container(
          alignment: Alignment.center,
          padding: const EdgeInsets.all(5),
          child: Column(
              mainAxisAlignment: MainAxisAlignment.spaceEvenly,
              mainAxisSize: MainAxisSize.max,
              children: [
                Text(dateData[dateData.length - 1].day.toString(),
                    style: const TextStyle(
                        fontSize: 15, color: CupertinoColors.inactiveGray),
                    textAlign: TextAlign.center),
                const SizedBox(height: 10)
              ]),
        ),
      ),
    );
  }
  // æ±‡æ€»æ‰€æœ‰æ—¥æœŸ
  for (int i = 0; i < datesOfThisMonth.length; i++) {
    returnData.add(datesOfThisMonth[i]);
  }
  return returnData;
}
```

å¤§å®¶æ³¨æ„é˜…è¯»è¿™æ®µä»£ç ï¼Œå½“æœˆæ—¥æœŸæˆ‘ç”¨äº†`CupertinoButton`ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¾ç„¶æ˜¯**å¢åŠ ç‚¹å‡»å“åº”ï¼Œä¹Ÿå°±æ˜¯ä¸ºç”¨æˆ·åˆ‡æ¢æ—¥æœŸæä¾›å¯èƒ½**ã€‚

è¿™é‡Œè¿”å›çš„`List<Widget>`æŒ‡çš„æ˜¯æ—¥æœŸçŸ©é˜µå†…å•ä¸ªå…ƒç´ ï¼Œè€Œéæ•´ä¸ªæ—¥æœŸçŸ©é˜µã€‚

å¤§å®¶è¿˜è®°å¾—å‰é¢æˆ‘æ›¾æåˆ°çš„æ•°å­— 7 å—ï¼Ÿ**æ—¥æœŸçŸ©é˜µä¸­ä¸€è¡Œæ°å¥½æ˜¯ 7 ä¸ªå…ƒç´ ï¼Œå…ƒç´ æ€»æ•°åˆæ˜¯ 7 çš„å€æ•°**ã€‚äºæ˜¯ï¼Œä¾¿å¯**é¦–å…ˆæ ¹æ®æ€»å…ƒç´ æ•°è®¡ç®—å‡ºæ€»è¡Œæ•°ï¼Œå†ä»¥ `7 * è¡Œæ•°` ä¸ºå¾ªç¯ç»“æŸæ¡ä»¶éå†æ•´ä¸ªçŸ©é˜µå…ƒç´ ï¼Œæœ€åå°†æ¯è¡Œå†…çš„å…ƒç´ ä½œä¸º Row ç»„ä»¶çš„å­ç»„ä»¶ï¼Œå†å°†æ‰€æœ‰è¡Œçš„ Row ç»„ä»¶ä½œä¸º Column ç»„ä»¶çš„å­ç»„ä»¶**ï¼Œæ„å»ºæ•´ä¸ªæ—¥æœŸçŸ©é˜µã€‚ä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

```
// ç”Ÿæˆæ—¥æœŸç»„ä»¶çŸ©é˜µ
List<Widget> allDatesWidget(List<Widget> allDates) {
  List<Widget> allLinesWidgets = [];
  int linesCount = allDates.length ~/ 7;
  for (int i = 0; i < linesCount; i++) {
    List<Widget> singleLineWidgets = [];
    for (int j = 0; j < 7; j++) {
      singleLineWidgets.add(allDates[i * 7 + j]);
    }
    allLinesWidgets.add(Row(
        mainAxisSize: MainAxisSize.max,
        mainAxisAlignment: MainAxisAlignment.spaceBetween,
        children: singleLineWidgets));
  }
  return allLinesWidgets;
}
@override
Widget build(BuildContext context) {
  return Container(
    color: CupertinoColors.white,
    padding: const EdgeInsets.all(15),
    child: Column(
      children: [
        // æ—¥æœŸçŸ©é˜µ
        Container(
          margin: const EdgeInsets.only(top: 10),
          child: Column(
            children: allDatesWidget(allDates()),
          ),
        )
      ],
    ),
  );
}
```

åˆ°æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å¯ä»¥å¾—åˆ°æ­£ç¡®çš„æ—¥æœŸçŸ©é˜µäº†ã€‚

åé¢çš„å·¥ä½œæ— éœ€å¤šè¯´ï¼Œè‡ªç„¶æ˜¯æ·»åŠ **å¹´æœˆæ˜¾ç¤º**ã€**ç›¸é‚»æœˆä»½è·³è½¬**ä»¥åŠ**æ•°æ®åº“æŸ¥è¯¢**å’Œ**UI æ˜¾ç¤º**äº†ã€‚è¿™äº›åŠŸèƒ½å®ç°èµ·æ¥éƒ½æ¯”è¾ƒç®€å•ï¼Œå¤§å®¶å¯ä»¥å…ˆè‡ªè¡Œå°è¯•å®ç°ã€‚æœ¬è®²æœ«å°¾é™„å½•ä¸ºå¤§å®¶æä¾›äº†å®Œæ•´çš„ explore_calendar.dart å’Œ calendar_widget.dart æºç ã€‚å¦‚æœä½ åœ¨å®ç°è¿‡ç¨‹ä¸­é‡åˆ°äº†å›°éš¾ï¼Œå¯ä»¥å‚è€ƒä½¿ç”¨ã€‚

## å°ç»“

ğŸ‰ æ­å–œï¼Œæ‚¨å®Œæˆäº†æœ¬æ¬¡è¯¾ç¨‹çš„å­¦ä¹ ï¼

ğŸ“Œ ä»¥ä¸‹æ˜¯æœ¬æ¬¡è¯¾ç¨‹çš„é‡ç‚¹å†…å®¹æ€»ç»“ï¼š

æœ¬è®²æˆ‘ä»¥æ—¥å†ä¸ºä¾‹ï¼Œä»‹ç»äº†å¦‚ä½•åœ¨ Flutter ä¸­å®ç°ç¨å¤æ‚çš„è‡ªå®šä¹‰ç»„ä»¶ã€‚é€šè¿‡æœ¬è®²çš„å­¦ä¹ ï¼Œç›¸ä¿¡å¤§å®¶å¯¹â€œä¸€åˆ‡çš†ç»„ä»¶â€è¿™å¥è¯æœ‰æ›´æ·±åˆ»çš„ç†è§£ï¼š**å†å¤æ‚çš„ç»„ä»¶ä¹Ÿä¸è¿‡æ˜¯åŸºç¡€ç»„ä»¶çš„æ’åˆ—ç»„åˆ**ã€‚

å¯¹äºè¾ƒä¸ºå¤æ‚çš„è‡ªå®šä¹‰ç»„ä»¶è€Œè¨€ï¼Œå®ç°å®ƒçš„æ­¥éª¤æ˜¯å…ˆè¿›è¡ŒåŠŸèƒ½æ‹†è§£ï¼ŒæŠŠçœ‹ä¼¼å¤æ‚çš„åŠŸèƒ½æ¢³ç†æˆæ¸…æ™°çš„éœ€æ±‚ï¼Œæ‹†è§£æˆè‹¥å¹²æ˜“äºå®ç°çš„â€œå°åŠŸèƒ½â€ã€‚ç„¶åé€ä¸ªâ€œå‡»ç ´â€å®ƒä»¬ã€‚

æ­¤å¤–ï¼Œå¯¹ Dart ç¼–ç¨‹è¯­è¨€çš„ç†è§£ä¹Ÿå¾ˆé‡è¦ã€‚æˆ‘ç›¸ä¿¡æœ‰çš„äººé¢å¯¹æ—¥æœŸè®¡ç®—ï¼Œä¼šä¸‹æ„è¯†åœ°è‡ªè¡Œå®ç°ã€‚è€Œè‡ªè¡Œå®ç°ä¼šé¢å¯¹å¾ˆå¤šæŒ‘æˆ˜ï¼Œæ¯”å¦‚é—°å¹´çš„å¤„ç†ã€å¹´/æœˆä»½çš„è‡ªåŠ¨åŠ /å‡ 1 ç­‰ç­‰ã€‚å¦‚æœä¹‹å‰å¯¹ DateTime æœ‰å°è±¡ï¼Œå°±ä¸è‡³äºåˆ›é€ è¿™äº›å›°éš¾ï¼Œè€Œæ˜¯è½»æ¾è§£å†³äº†ã€‚

å¥½äº†ï¼Œæœ¬è®²åˆ°æ­¤å°±è¯¥å’Œå¤§å®¶è¯´å†è§äº†ã€‚

åœ¨ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘å°†ä»‹ç»äº‹ä»¶æ€»çº¿çš„ä½¿ç”¨æ–¹æ³•ï¼Œå®ƒå’Œè§‚å¯Ÿè€…æ¨¡å¼å¾ˆåƒï¼Œä½†åˆä¸å®Œå…¨ä¸€æ ·ã€‚å®ƒä»¬éƒ½æ˜¯å‘å¸ƒè®¢é˜…æ¨¡å‹ï¼Œä¸ºç¼–ç æä¾›äº†å¾ˆå¤šæ–¹ä¾¿ã€‚è®©æˆ‘ä»¬æ‹­ç›®ä»¥å¾…ï¼Œä¸‹ä¸€è®²è§ï¼

## é™„å½•ä¸€ï¼šexplore_calendar.dart å®Œæ•´æºç 

```
import 'package:flutter/cupertino.dart';
import '../../../util/db_util.dart';
import '../widget/diary_list_widget.dart';
import 'widget/calender_widget.dart';
class ExploreCalenderPage extends StatefulWidget {
  const ExploreCalenderPage({Key? key}) : super(key: key);
  @override
  State<ExploreCalenderPage> createState() => _ExploreCalenderPageState();
}
class _ExploreCalenderPageState extends State<ExploreCalenderPage> {
  List<Map<String, Object?>> allDiaryRow = [];
  List<Diary> allDiary = [];
  List<Map<String, Object?>> allDiaryMonthlyRow = [];
  List<Diary> allDiaryMonthly = [];
  var saveDiaryDoneListener;
  DateTime selectedDate = DateTime.now();
  Set<DateTime> markedDates = {};
  // æ—¥æœŸé€‰æ‹©å™¨ç»„ä»¶
  Widget calenderSelector() {
    return CalenderWidget(
      markedDate: markedDates,
      onDateChanged: (currentDate) {
        selectedDate = currentDate;
        loadAllDiary();
      },
    );
  }
  // è½½å…¥æ‰€æœ‰æ—¥è®°
  void loadAllDiary() async {
    await DatabaseUtil.instance.openDb();
    // è¯»å–å½“å¤©çš„æ—¥è®°
    allDiaryRow = await DatabaseUtil.instance.queryByDate(selectedDate);
    allDiary.clear();
    if (allDiaryRow.isNotEmpty) {
      for (int i = 0; i < allDiaryRow.length; i++) {
        allDiary.add(Diary().fromMap(allDiaryRow[i]));
      }
    }
    // è¯»å–å½“æœˆçš„æ—¥è®°
    allDiaryMonthlyRow = await DatabaseUtil.instance.queryByMonth(selectedDate);
    if (allDiaryMonthlyRow.isNotEmpty) {
      for (int i = 0; i < allDiaryMonthlyRow.length; i++) {
        Diary singleDiary = Diary().fromMap(allDiaryMonthlyRow[i]);
        markedDates.add(DateTime(singleDiary.date.year, singleDiary.date.month,
            singleDiary.date.day));
      }
    }
    setState(() {});
  }
  @override
  void initState() {
    super.initState();
    loadAllDiary();
  }
  @override
  Widget build(BuildContext context) {
    return SafeArea(
      child: Container(
        decoration: const BoxDecoration(
          image: DecorationImage(
            fit: BoxFit.cover,
            image: AssetImage('assets/image/bg.jpg'),
          ),
        ),
        child: Column(
          children: [
            calenderSelector(),
            Container(height: 5),
            Expanded(
              child: SingleChildScrollView(
                child: DiaryListWidget.diaryList(allDiary),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

## é™„å½•äºŒï¼šcalendar_widget.dart å®Œæ•´æºç 

```
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';
import '../../../../constants.dart';
import '../../../../util/datetime_util.dart';
class CalenderWidget extends StatefulWidget {
  const CalenderWidget(
      {Key? key, required this.markedDate, required this.onDateChanged})
      : super(key: key);
  final Set<DateTime> markedDate;
  final Function onDateChanged;
  @override
  State<StatefulWidget> createState() => _CalenderWidgetState();
}
class _CalenderWidgetState extends State<CalenderWidget> {
  DateTime currentDate = DateTime.now();
  // è·³åˆ°ä¸Šä¸€ä¸ªæœˆ
  void jumpToPreviousMonth() {
    setState(() {
      currentDate = currentDate.subtract(const Duration(days: 31));
    });
    widget.onDateChanged(currentDate);
  }
  // è·³åˆ°ä¸‹ä¸€ä¸ªæœˆ
  void jumpToNextMonth() {
    setState(() {
      currentDate = currentDate.add(const Duration(days: 31));
    });
    widget.onDateChanged(currentDate);
  }
  // å¹´æœˆé¡¶æ 
  Widget topBar() {
    return Row(
      mainAxisSize: MainAxisSize.max,
      mainAxisAlignment: MainAxisAlignment.spaceBetween,
      children: [
        SizedBox(
          width: 20,
          child: CupertinoButton(
            padding: const EdgeInsets.all(0),
            child: const Icon(CupertinoIcons.arrow_left, size: 18),
            onPressed: () {
              jumpToPreviousMonth();
            },
          ),
        ),
        Text(DateTimeUtil.parseMonth(currentDate)),
        SizedBox(
          width: 20,
          child: CupertinoButton(
            padding: const EdgeInsets.all(0),
            child: const Icon(CupertinoIcons.arrow_right, size: 18),
            onPressed: () {
              jumpToNextMonth();
            },
          ),
        ),
      ],
    );
  }
  // å­˜åœ¨æ—¥å¿—æŒ‡ç¤ºç¯
  Widget diaryExistDot() {
    return const SizedBox(
      width: 4,
      height: 4,
      child: CircleAvatar(),
    );
  }
  // è®¡ç®—å¹¶ç”Ÿæˆå•ä¸ªæ—¥æœŸç»„ä»¶
  List<Map> allDates() {
    int currentDay = currentDate.day;
    List<Map> returnData = [];
    DateTime singleDate = DateTime(currentDate.year, currentDate.month, 1);
    int month = currentDate.month;
    List<Widget> datesOfThisMonth = [];
    List<DateTime> dateData = [];
    // ä¸Šä¸ªæœˆæ—¥æœŸå¡«å……
    for (int i = 0; i < singleDate.weekday; i++) {
      dateData.add(singleDate.subtract(Duration(days: singleDate.weekday - i)));
      datesOfThisMonth.add(
        Expanded(
          child: Container(
              alignment: Alignment.center,
              padding: const EdgeInsets.all(5),
              child: Column(
                mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                mainAxisSize: MainAxisSize.max,
                children: [
                  Text(
                    dateData[i].day.toString(),
                    style: const TextStyle(
                        fontSize: 15, color: CupertinoColors.inactiveGray),
                    textAlign: TextAlign.center,
                  ),
                  const SizedBox(height: 10)
                ],
              )),
        ),
      );
    }
    // æœ¬æœˆé¦–å¤©
    dateData.add(singleDate);
    // æœ¬æœˆæ—¥æœŸå¡«å……
    while (singleDate.month == month) {
      DateTime uniqueDate = singleDate;
      datesOfThisMonth.add(
        Expanded(
          child: CupertinoButton(
            padding: const EdgeInsets.all(0),
            child: Container(
                alignment: Alignment.center,
                padding: const EdgeInsets.all(5),
                child: CircleAvatar(
                  backgroundColor: currentDay == singleDate.day
                      ? Consts.themeColor
                      : CupertinoColors.white,
                  child: Column(
                    mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                    mainAxisSize: MainAxisSize.max,
                    children: [
                      Text(singleDate.day.toString(),
                          style: TextStyle(
                              fontSize: 15,
                              color: currentDay == singleDate.day
                                  ? CupertinoColors.white
                                  : CupertinoColors.black),
                          textAlign: TextAlign.center),
                      widget.markedDate.contains(uniqueDate) &&
                              currentDay != singleDate.day
                          ? diaryExistDot()
                          : const SizedBox(height: 4)
                    ],
                  ),
                )),
            onPressed: () {
              setState(() {
                currentDate = uniqueDate;
              });
              widget.onDateChanged(currentDate);
            },
          ),
        ),
      );
      dateData.add(singleDate.add(const Duration(days: 1)));
      singleDate = singleDate.add(const Duration(days: 1));
    }
    // ä¸‹æœˆæ—¥æœŸå¡«å……
    for (int i = 0; i < 7 - singleDate.weekday; i++) {
      dateData.add(singleDate.add(Duration(days: i)));
      datesOfThisMonth.add(
        Expanded(
          child: Container(
            alignment: Alignment.center,
            padding: const EdgeInsets.all(5),
            child: Column(
                mainAxisAlignment: MainAxisAlignment.spaceEvenly,
                mainAxisSize: MainAxisSize.max,
                children: [
                  Text(dateData[dateData.length - 1].day.toString(),
                      style: const TextStyle(
                          fontSize: 15, color: CupertinoColors.inactiveGray),
                      textAlign: TextAlign.center),
                  const SizedBox(height: 10)
                ]),
          ),
        ),
      );
    }
    // æ±‡æ€»æ‰€æœ‰æ—¥æœŸ
    for (int i = 0; i < datesOfThisMonth.length; i++) {
      returnData.add({'date': dateData[i], 'widget': datesOfThisMonth[i]});
    }
    return returnData;
  }
  // ç”Ÿæˆæ—¥æœŸç»„ä»¶çŸ©é˜µ
  List<Widget> allDatesWidget(List<Map> allDates) {
    List<Widget> allLinesWidgets = [];
    int linesCount = allDates.length ~/ 7;
    for (int i = 0; i < linesCount; i++) {
      List<Widget> singleLineWidgets = [];
      for (int j = 0; j < 7; j++) {
        singleLineWidgets.add(allDates[i * 7 + j]['widget'] as Widget);
      }
      allLinesWidgets.add(Row(
          mainAxisSize: MainAxisSize.max,
          mainAxisAlignment: MainAxisAlignment.spaceBetween,
          children: singleLineWidgets));
    }
    return allLinesWidgets;
  }
  @override
  Widget build(BuildContext context) {
    return Container(
      color: CupertinoColors.white,
      padding: const EdgeInsets.all(15),
      child: Column(
        children: [
          // å¹´æœˆé¡¶æ 
          topBar(),
          // åˆ†å‰²çº¿
          Container(
            height: 10,
          ),
          // æ˜ŸæœŸæ˜¾ç¤ºæ ‡å¤´
          Row(
            mainAxisSize: MainAxisSize.max,
            mainAxisAlignment: MainAxisAlignment.spaceBetween,
            children: const [
              Expanded(
                child: Text('æ—¥',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
              Expanded(
                child: Text('ä¸€',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
              Expanded(
                child: Text('äºŒ',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
              Expanded(
                child: Text('ä¸‰',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
              Expanded(
                child: Text('å››',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
              Expanded(
                child: Text('äº”',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
              Expanded(
                child: Text('å…­',
                    style: TextStyle(
                        color: CupertinoColors.placeholderText, fontSize: 15),
                    textAlign: TextAlign.center),
              ),
            ],
          ),
          // æ—¥æœŸçŸ©é˜µ
          Container(
            margin: const EdgeInsets.only(top: 10),
            child: Column(
              children: allDatesWidget(allDates()),
            ),
          )
        ],
      ),
    );
  }
}
```