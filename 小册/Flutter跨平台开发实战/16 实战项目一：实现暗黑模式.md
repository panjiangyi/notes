è¯´åˆ°â€œæš—é»‘æ¨¡å¼â€ï¼Œå¤§å®¶ä¸€å®šä¸ä¼šé™Œç”Ÿã€‚éšç€ iOS 13 ä¸ Android 10 çš„æ¨å‡ºï¼Œæš—é»‘æ¨¡å¼æ›´æ˜¯æˆä¸ºé›†æˆåœ¨ç³»ç»Ÿä¸­çš„ä¸»é¢˜æ–¹æ¡ˆå¹¿æ³›æ¨å¹¿ï¼Œæ·±å—ç”¨æˆ·çš„å–œçˆ±ã€‚æˆ‘ä»¬çš„â€œä¸€è¨€â€App è‡ªç„¶ä¹Ÿä¸èƒ½è½ä¸‹è¿™ä¸€åŠŸèƒ½ï¼ŒFlutter è‡ªä» 2019 å¹´å¼€å§‹ï¼Œå°±å·²ç»å†…ç½®äº†æš—é»‘æ¨¡å¼æ”¯æŒï¼Œä¸ºå¼€å‘è€…æä¾›äº†é€‚é…ä¸Šçš„ä¾¿åˆ©ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸»é¢˜åˆ‡æ¢å‰åçš„æ•ˆæœå›¾ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/45c2e126775442df913eb104394b771b~tplv-k3u1fbpfcp-zoom-1.image)

æ˜¾ç„¶ï¼Œç¨‹åºçš„èƒŒæ™¯ã€æ–‡å­—ä»¥åŠå³ä¸Šè§’çš„ä¸»é¢˜åˆ‡æ¢æŒ‰é’®éƒ½å‘ç”Ÿäº†åè½¬ï¼Œç”±æ—¥é—´çš„äº®è‰²æ¨¡å¼åˆ‡æ¢ä¸ºå¤œæ™šçš„æš—è‰²æ¨¡å¼ã€‚

æ­¤å¤–ï¼Œâ€œä¸€è¨€â€App è¿˜æ”¯æŒéšç³»ç»Ÿè®¾ç½®è‡ªåŠ¨åˆ‡æ¢ä¸»é¢˜çš„åŠŸèƒ½ã€‚å³å½“ç³»ç»Ÿè®¾ç½®ä¸ºé»‘æš—æ¨¡å¼æ—¶ï¼ŒApp ä¹Ÿéšä¹‹åˆ‡æ¢ä¸ºé»‘æš—æ¨¡å¼ã€‚

ç°åœ¨ï¼Œæ±‡æ€»ä¸€ä¸‹è¦å®ç°çš„åŠŸèƒ½å’Œåˆ‡æ¢é€»è¾‘ï¼š

1.  **App æ˜¾ç¤ºæ¨¡å¼éšç³»ç»Ÿè®¾ç½®å‘ç”Ÿå˜åŒ–ï¼Œä¸”ä¸ºé»˜è®¤æ˜¾ç¤ºæ¨¡å¼**ï¼›
1.  **ç”¨æˆ·å¯ä»¥é€šè¿‡ App ä¸­çš„ä¸»é¢˜åˆ‡æ¢æŒ‰é’®è‡ªä¸»é€‰æ‹©æ˜¾ç¤ºæ¨¡å¼**ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬çš„å®ç°é€»è¾‘åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š**å½“æœ‰ç”¨æˆ·è‡ªå®šä¹‰çš„æ˜¾ç¤ºè®¾ç½®å€¼æ—¶ï¼ŒæŒ‰ç…§è¯¥è®¾ç½®å€¼æ˜¾ç¤ºï¼Œå¦åˆ™å°±è·Ÿéšç³»ç»Ÿæ ·å¼**ã€‚

`ğŸ’¡ æç¤ºï¼šæˆ‘ä»¬å¯ä»¥åœ¨å¾ˆå¤š App ä¸­å‘ç°ä¸Šè¿°åˆ‡æ¢é€»è¾‘ï¼Œåªä¸è¿‡å®ƒä»¬çš„ä¸»é¢˜æ›´åŠ ä¸°å¯Œï¼Œä¸åªå±€é™äºäº®è‰²å’Œæš—è‰²ã€‚ä¸€äº› App ä¸­ï¼Œæš—è‰²æ¨¡å¼åªæœ‰ä¸€ç§ä¸»é¢˜ï¼Œä½†äº®è‰²æ¨¡å¼çš„ä¸»é¢˜æœ‰å¾ˆå¤šã€‚å¦ä¸€æ–¹é¢ï¼Œæ¯ä¸€ç§ä¸»é¢˜éƒ½åŒ…å«ç€ä¸€æ•´å¥—é…è‰²æ–¹æ¡ˆã€‚æ¯”å¦‚åœ¨äº®è‰²ä¸»é¢˜ä¸­ï¼Œæ–‡å­—å’ŒæŒ‰é’®æ˜¯é»‘è‰²çš„ï¼›æš—è‰²ä¸»é¢˜ä¸­ï¼Œæ–‡å­—å’ŒæŒ‰é’®æ˜¯ç™½è‰²çš„ï¼›æ·±è“è‰²ä¸»é¢˜ä¸­ï¼Œæ–‡å­—å’ŒæŒ‰é’®æ˜¯å¥¶é»„è‰²çš„ï¼›çº¢è‰²ä¸»é¢˜ä¸­ï¼Œæ–‡å­—å’ŒæŒ‰é’®æ˜¯ç™½è‰²çš„ç­‰ç­‰ã€‚å…·ä½“å¦‚ä½•æ­é…é¢œè‰²ï¼Œä¸€èˆ¬æ˜¯ç”±ä»äº‹è®¾è®¡å²—ä½çš„åŒäº‹æ¥åˆ¶å®šçš„ã€‚ä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬åªéœ€è¦æ ¹æ®é…è‰²è¡¨è¿›è¡Œé¢œè‰²å®šä¹‰å³å¯ã€‚`

æœ‰äº†éœ€æ±‚å®šä¹‰ï¼Œä¹Ÿæœ‰äº†å®ç°é€»è¾‘ï¼Œæ¥ä¸‹æ¥å°±åˆ°äº†åŠ¨æ‰‹ç¯èŠ‚ã€‚æˆ‘ä»¬å…ˆæ¥å®ç°è®© App è·Ÿéšç³»ç»Ÿä¸»é¢˜æ˜¾ç¤ºçš„åŠŸèƒ½ã€‚

## ä¸»é¢˜æ ·å¼è·Ÿéšç³»ç»Ÿ

è¿˜è®°å¾—æ˜¯å¦‚ä½•è‡ªå®šä¹‰å­—ä½“çš„å—ï¼Ÿæ²¡é”™ï¼Œå½“æ—¶æˆ‘ä»¬ç”¨åˆ°çš„å°±æ˜¯ä¸»é¢˜å®šä¹‰çš„æ–¹å¼ï¼Œä»£ç æ˜¯è¿™æ ·çš„ï¼š

```
@override
Widget build(BuildContext context) {
  return MaterialApp(
    theme: ThemeData(fontFamily: 'ShuYunSong'),
    ...
  );
}
```

ç»§ç»­æ·±å…¥æ¢ç´¢ MaterialApp çš„å‚æ•°åˆ—è¡¨ï¼Œä¼šå‘ç°è¿˜æœ‰ä¸€ä¸ª darkTheme å‚æ•°ã€‚darkTheme å°±æ˜¯æš—è‰²æ¨¡å¼çš„ä¸»é¢˜é…è‰²æ–¹æ¡ˆäº†ï¼Œ**å½“ç³»ç»Ÿè®¾ç½®ä¸ºæš—è‰²æ¨¡å¼ä¸”è¯¥å‚æ•°æœ‰å€¼æ—¶ï¼ŒApp å°±ä¼šæŒ‰ç…§è¯¥å‚æ•°å®šä¹‰çš„ä¸»é¢˜é¢œè‰²è¿›è¡Œå‘ˆç°**ã€‚

å›åˆ°æœ¬ä¾‹ï¼Œåªéœ€å¯¹åŸä»£ç ä½œå‡ºå¦‚ä¸‹ä¿®æ”¹ï¼Œå³å¯å®ç°ä¸»é¢˜æ ·å¼è·Ÿéšç³»ç»Ÿçš„æ•ˆæœï¼š

```
@override
Widget build(BuildContext context) {
  return MaterialApp(
    theme: ThemeData(fontFamily: 'ShuYunSong', brightness: Brightness.light),
    darkTheme: ThemeData(fontFamily: 'ShuYunSong', brightness: Brightness.dark),
    ...
  );
}
```

`â—ï¸ æ³¨æ„ï¼šåˆ«å¿˜äº†åœ¨ darkTheme ä¸­ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ã€‚`

å®Œæˆä¿®æ”¹åï¼Œå†æ¬¡è¿è¡Œ Appã€‚ç„¶ååˆ°ç³»ç»Ÿæ˜¾ç¤ºè®¾ç½®ä¸­è¿›è¡Œäº®/æš—è‰²åˆ‡æ¢ï¼Œæœ€åå†å›åˆ° Appï¼Œå¯ä»¥å‘ç° App çš„æ˜¾ç¤ºæ ·å¼å¯ä»¥éšç³»ç»Ÿè®¾ç½®å‘ç”Ÿå˜åŒ–ï¼Œä¸”æ— éœ€é‡æ–°æ‰“å¼€ç¨‹åºã€‚æ•ˆæœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/41fb1c350eb04aeebd04f225263454e6~tplv-k3u1fbpfcp-zoom-1.image)

ä»”ç»†çœ‹è¿™å¼ å›¾ï¼Œå’Œæœ¬è®²å¼€å¤´çš„å›¾è¿›è¡Œå¯¹æ¯”ï¼Œæœ‰æ²¡æœ‰å‘ç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ

æš—è‰²æ¨¡å¼ä¸‹ï¼Œå³ä¸Šè§’çš„å›¾æ ‡åº”è¯¥æ˜¯ç©ºå¿ƒçš„æ‰å¯¹ï¼Œè€Œä¸åº”è¯¥åªæ˜¯ç®€å•åœ°å˜ä¸ªé¢œè‰²å°±è¡Œäº†ã€‚

æ‰€ä»¥ï¼Œè¿™é‡Œè¿˜éœ€è¦åšä¸€ä¸ªâ€œ**ç›‘å¬å™¨**â€ï¼Œå½“éœ€è¦åˆ‡æ¢ä¸»é¢˜æ—¶ï¼Œè‹¥ä¸ºäº®è‰²æ¨¡å¼ï¼Œåˆ™ä½¿ç”¨å®å¿ƒçš„å›¾æ ‡ï¼›åä¹‹ï¼Œåˆ™ä½¿ç”¨ç©ºå¿ƒçš„å›¾æ ‡ã€‚è‡³äºé¢œè‰²ï¼Œç³»ç»Ÿé»˜è®¤çš„æš—è‰²æ¨¡å¼å·²ç»å®šä¹‰å¥½é…è‰²æ–¹æ¡ˆï¼Œæˆ‘ä»¬æ— éœ€ç†ä¼šã€‚

é‚£ä¹ˆï¼Œè¿™ä¸ªâ€œç›‘å¬å™¨â€è¯¥æ€ä¹ˆå®ç°å‘¢ï¼Ÿ

## ç›‘å¬ç³»ç»Ÿè®¾ç½®å˜åŒ–

Flutter æä¾›äº†ä¸€ä¸ªåä¸ºâ€œWidgetsBindingObserverâ€çš„æŠ½è±¡ç±»ï¼Œå®ƒ**é€šå¸¸ç”¨ä½œç›‘å¬ç”Ÿå‘½å‘¨æœŸ**ã€‚ç”±æ­¤ä¾¿å¯åœ¨é€‚å½“çš„æ—¶æœºä½œå‡ºæ°å½“çš„å¤„ç†ï¼Œæ¯”å¦‚ä¸€ä¸ªèµ›è½¦æ¸¸æˆï¼Œå½“ç”¨æˆ·å›åˆ° Home åï¼Œæ¸¸æˆåº”è¯¥è‡ªåŠ¨æš‚åœã€‚ä¹Ÿå°±æ˜¯å½“ç•Œé¢ä¸å¯è§æ—¶ï¼Œè‹¥æ¸¸æˆä»åœ¨è¿›è¡Œä¸­ï¼Œåˆ™æ‰§è¡Œæš‚åœå¤„ç†ã€‚å¦åˆ™ï¼Œå½“ç”¨æˆ·å†æ¬¡å›åˆ°æ¸¸æˆæ—¶ï¼Œä¼šå‘ç°è‡ªå·±çš„èµ›è½¦æ—©å°±æ’æ¯äº†â€¦â€¦

è¿™ä¸ªç±»é™¤äº†èƒ½ç”¨ä½œç›‘å¬ç”Ÿå‘½å‘¨æœŸï¼Œè¿˜èƒ½æä¾›å¾ˆå¤šå®ç”¨çš„å›è°ƒï¼Œæ¯”å¦‚å†…å­˜ä¸è¶³ã€å±å¹•æ—‹è½¬ã€ç³»ç»Ÿä¸»é¢˜è®¾ç½®å˜åŒ–ç­‰ç­‰ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡å®ç°è¯¥ç±»çš„æ¥å£ï¼Œè½»æ¾å®Œæˆå¯¹ç³»ç»Ÿä¸»é¢˜è®¾ç½®çš„ç›‘å¬ï¼Œä»è€Œè¾¾æˆæœ€ç»ˆçš„å®ç°æ ·å¼ã€‚å…·ä½“å®ç°ä»£ç å¦‚ä¸‹ï¼š

```
class _MyAppState extends State<MyApp> with WidgetsBindingObserver {
  bool darkModeOn = false;
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addObserver(this);
  }
  @override
  void dispose() {
    WidgetsBinding.instance.removeObserver(this);
    super.dispose();
  }
  @override
  void didChangePlatformBrightness() {
    Brightness brightness = WidgetsBinding.instance.window.platformBrightness;
    setState(() {
      if (brightness.name == "light") {
        darkModeOn = false;
      } else {
        darkModeOn = true;
      }
    });
  }
  ...
}  
```

æ­£ç¡®ä½¿ç”¨ WidgetsBindingObserver çš„å§¿åŠ¿å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œ**é¦–å…ˆè¦åœ¨ initState() ä¸­è°ƒç”¨ addObserver() æ·»åŠ â€œè§‚å¯Ÿè€…â€** ï¼Œ**ç„¶åå®ç°ç›¸åº”çš„å›è°ƒæ–¹æ³•**ï¼ˆæœ¬ä¾‹æ˜¯ didChangePlatformBrightness()ï¼‰ï¼Œ**æœ€ååœ¨ dispose() æ–¹æ³•ä¸­è°ƒç”¨ removeObserver() ç§»é™¤â€œè§‚å¯Ÿè€…â€** ã€‚

è¿™æ®µä»£ç ä¸­ï¼Œå¸ƒè€Œç±»å‹çš„ darkModeOn å˜é‡è¡¨ç¤ºå½“å‰ç³»ç»Ÿè®¾ç½®æ˜¯å¦ä¸ºæš—è‰²æ¨¡å¼ã€‚true ä»£è¡¨æ˜¯ï¼›åä¹‹åˆ™ä¸æ˜¯ã€‚

æ¥ç€ï¼Œåœ¨åé¢çš„ build() æ–¹æ³•ä¸­ï¼Œæ ¹æ® dartModeOn æ¥åˆ‡æ¢ Icon ç»„ä»¶ï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹ï¼š

```
MaterialButton(
  padding: const EdgeInsets.all(0),
  child: Icon(
      darkModeOn ? Icons.dark_mode_outlined : Icons.dark_mode,
      size: 25),
  onPressed: () {
    setState(() {
      darkModeOn = !darkModeOn;
    });
  },
),
```

åŒæ—¶ï¼Œå¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œå½“ç”¨æˆ·æŒ‰ä¸‹è¿™ä¸ªæŒ‰é’®æ—¶ï¼Œå…è®¸æ‰‹åŠ¨åˆ‡æ¢ App äº®/æš—è‰²æ˜¾ç¤ºæ¨¡å¼ã€‚å› æ­¤ï¼Œåœ¨ onPressed å‚æ•°ä¸­åˆ‡æ¢ darkModeOn çš„å€¼ï¼Œä½†æ­¤æ—¶å¹¶æ²¡æœ‰ä»€ä¹ˆæ•ˆæœã€‚

## æ‰‹åŠ¨åˆ‡æ¢ä¸»é¢˜æ ·å¼

ç”±äº theme å’Œ darkTheme å¹¶æœªä¸ darkModeOn å˜é‡äº§ç”Ÿè”åŠ¨ï¼Œæ‰€ä»¥å³ä½¿æ”¹å˜äº†è¿™ä¸ªå˜é‡çš„å€¼ï¼ŒApp çš„ä¸»é¢˜ä¹Ÿä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ã€‚

æ‰€ä»¥ï¼Œå…‰é ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„ darkModeOn å˜é‡æ¥æ§åˆ¶ App çš„ä¸»é¢˜ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘åœ¨è¿™é‡Œå¼•å…¥äº†å¦ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å˜é‡ customThemeï¼Œè¯¥å˜é‡çš„é»˜è®¤å€¼ä¸º falseï¼Œè¡¨ç¤ºéè‡ªå®šä¹‰ä¸»é¢˜çŠ¶æ€ã€‚å½“ç”¨æˆ·æŒ‰äº†åˆ‡æ¢æŒ‰é’®åï¼Œè¯¥å˜é‡å€¼æ”¹ä¸º trueã€‚

ä¸ä¹‹ç´§å¯†ç›¸å…³çš„ä¾¿æ˜¯ä¸Šéƒ¨åˆ†è®²è¿‡çš„ä¸»é¢˜åˆ‡æ¢ï¼Œå½“è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆcustomTheme ä¸º trueï¼‰æ—¶ï¼Œå³ä½¿ç³»ç»Ÿä¸»é¢˜å‘ç”Ÿå˜åŒ–ï¼Œä¹Ÿä¸ä¼šæ”¹å˜ darkModeOn çš„å€¼ã€‚è¿™éƒ¨åˆ†çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š

```
@override
void didChangePlatformBrightness() {
  Brightness brightness = WidgetsBinding.instance.window.platformBrightness;
  if (!customTheme) {
    setState(() {
      if (brightness.name == "light") {
        darkModeOn = false;
      } else {
        darkModeOn = true;
      }
    });
  }
}
```

ä¸ä¹‹é…åˆçš„ä¾¿æ˜¯ theme å’Œ darkTheme çš„å‚æ•°èµ‹å€¼ï¼š

-   å¯¹äº themeï¼Œå½“è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆcustomTheme ä¸º trueï¼‰ä¸”éœ€è¦äº®è‰²æ˜¾ç¤ºï¼ˆdartModeOn ä¸º falseï¼‰ï¼Œä»¥åŠä¸éœ€è¦è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆcustomTheme ä¸º falseï¼‰æ—¶ï¼Œbrightness çš„å€¼éƒ½ä¸º Brightness.lightï¼›å¦åˆ™ä¸º Brightness.darkã€‚
-   å¯¹äº darkThemeï¼Œå½“è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆcustomTheme ä¸º trueï¼‰ä¸”éœ€è¦æš—è‰²æ˜¾ç¤ºï¼ˆdartModeOn ä¸º trueï¼‰ï¼Œä»¥åŠä¸éœ€è¦è‡ªå®šä¹‰ä¸»é¢˜ï¼ˆcustomTheme ä¸º falseï¼‰æ—¶ï¼Œbrightness çš„å€¼éƒ½ä¸º Brightness.darkï¼›å¦åˆ™ä¸º Brightness.lightã€‚

ç›¸åº”çš„ä»£ç ä¿®æ”¹å¦‚ä¸‹ï¼š

```
theme: ThemeData(
    fontFamily: 'ShuYunSong',
    brightness: customTheme && !darkModeOn
        ? Brightness.light
        : customTheme && darkModeOn
            ? Brightness.dark
            : Brightness.light),
darkTheme: ThemeData(
    fontFamily: 'ShuYunSong',
    brightness: customTheme && !darkModeOn
        ? Brightness.light
        : customTheme && darkModeOn
            ? Brightness.dark
            : Brightness.dark),
```

çƒ­åŠ è½½åï¼Œå†æ¬¡ç‚¹æŒ‰å³ä¸Šè§’çš„ä¸»é¢˜åˆ‡æ¢ï¼Œå¯è§ä¸»é¢˜å·²ç»æŒ‰ç”¨æˆ·çš„éœ€è¦å‘ç”Ÿå˜åŒ–äº†ã€‚å¦å¤–ï¼Œæ— è®ºç³»ç»Ÿä¸»é¢˜å¦‚ä½•æ”¹å˜ï¼Œä¹Ÿä¸ä¼šå½±å“ App è‡ªèº«çš„ä¸»é¢˜æ ·å¼ã€‚

å®Œæ•´é‡æ–°è¿è¡Œåï¼Œå…ˆè¿›è¡Œç³»ç»Ÿä¸»é¢˜åˆ‡æ¢ï¼Œå¯è§ App ä¸»é¢˜è·Ÿéšç³»ç»Ÿã€‚ç„¶åï¼Œç‚¹å‡»å³ä¸Šè§’çš„ä¸»é¢˜åˆ‡æ¢ï¼ŒApp çš„ä¸»é¢˜éšç”¨æˆ·é€‰æ‹©è¿›è¡Œåˆ‡æ¢ï¼Œä¸å†è·Ÿéšç³»ç»Ÿè®¾ç½®ã€‚

ç›®æ ‡è¾¾æˆï¼

å¦‚æœä½ å°è¯•äº†åŠå¤©ï¼Œè¿˜æ²¡è¾¾æˆç›®æ ‡ï¼Œä¸å¦¨å‚è€ƒæœ¬è®²æœ«å°¾é™„å½•éƒ¨åˆ†çš„å®Œæ•´ä»£ç ã€‚

## **å°ç»“**

ğŸ‰æ­å–œï¼Œæ‚¨å®Œæˆäº†æœ¬æ¬¡è¯¾ç¨‹çš„å­¦ä¹ ï¼

ğŸ“Œ ä»¥ä¸‹æ˜¯æœ¬æ¬¡è¯¾ç¨‹çš„é‡ç‚¹å†…å®¹æ€»ç»“ï¼š

åœ¨æœ¬è®²ä¸­ï¼Œå®Œç»“äº†ã€Šä¸€è¨€ã€‹App çš„å¼€å‘å…¨è¿‡ç¨‹ã€‚

åœ¨æœ€åä¸€éƒ¨åˆ†ï¼Œæˆ‘ä»‹ç»äº†å¦‚ä½•å®ç°äº®/æš—è‰²ä¸»é¢˜åˆ‡æ¢ã€‚å…·ä½“çš„åˆ‡æ¢é€»è¾‘å’Œç›®å‰å¾ˆå¤š App ä¿æŒä¸€è‡´ï¼š

1.  App æ˜¾ç¤ºæ¨¡å¼éšç³»ç»Ÿè®¾ç½®å‘ç”Ÿå˜åŒ–ï¼Œä¸”ä¸ºé»˜è®¤æ˜¾ç¤ºæ¨¡å¼ï¼›
1.  ç”¨æˆ·å¯ä»¥é€šè¿‡ App ä¸­çš„ä¸»é¢˜åˆ‡æ¢æŒ‰é’®è‡ªä¸»é€‰æ‹©æ˜¾ç¤ºæ¨¡å¼ã€‚

åœ¨å…·ä½“çš„å®ç°è¿‡ç¨‹ä¸­ï¼Œæˆ‘è¿˜ä»‹ç»äº†ä¸€ä¸ªéå¸¸å®ç”¨çš„æŠ½è±¡ç±»ï¼šWidgetsBindingObserverã€‚å®ƒæä¾›äº†ç›‘å¬ç”Ÿå‘½å‘¨æœŸã€ç³»ç»Ÿä¸»é¢˜æ ·å¼è®¾ç½®ç­‰ä¼—å¤šç›‘å¬å™¨ã€‚å®ç°è¿™ä¸ªç±»æ—¶ï¼Œè¯·ä¸€å®šè¦éµå¾ªä¸€èˆ¬æ­¥éª¤ï¼Œå³ï¼š

1.  åœ¨ initState() ä¸­è°ƒç”¨ addObserver() æ·»åŠ â€œè§‚å¯Ÿè€…â€ï¼›
1.  å®ç°ç›¸åº”çš„å›è°ƒæ–¹æ³•ï¼›
1.  åœ¨ dispose() æ–¹æ³•ä¸­è°ƒç”¨ removeObserver() ç§»é™¤â€œè§‚å¯Ÿè€…â€ã€‚

å…¶ä¸­ç¬¬ 1 å’Œ 3 æ­¥éå¸¸é‡è¦ï¼Œç¼ºå°‘ç¬¬ 1 æ­¥ï¼Œå›è°ƒæ–¹æ³•ä¸ä¼šå¥æ•ˆï¼Œç¼ºå°‘ç¬¬ 3 æ­¥ï¼Œèµ„æºæ²¡æœ‰å›æ”¶å°†å¯¼è‡´å†…å­˜å ç”¨ç‡é«˜ï¼Œç”šè‡³ç¨‹åºå´©æºƒçš„åæœã€‚

â¡ï¸ ä»ä¸‹ä¸€è®²å¼€å§‹ï¼Œæˆ‘ä»¬å°±è¦è¿›å…¥æ–°çš„å•å…ƒï¼šã€Šä½ çš„åå­—ã€‹æ—¥è®° App çš„å®æˆ˜ã€‚åœ¨æ–°çš„å®æˆ˜é¡¹ç›®ä¸­ï¼Œæˆ‘ä¼šä»‹ç»é¡µé¢å¯¼èˆªè®¾è®¡ã€æœ¬åœ°æ•°æ®åº“ IOã€EventBus äº‹ä»¶æ€»çº¿ç­‰å®ç”¨æŠ€èƒ½ï¼Œæˆ‘ä»¬è¿˜ä¼šå†æ¬¡ä¸è‡ªå®šä¹‰ç»„ä»¶ç›¸é‡ï¼Œä¸è¿‡è¿™ä¸€æ¬¡éš¾åº¦ä¼šæ›´é«˜ã€‚è®©æˆ‘ä»¬åšå¥½å‡†å¤‡ï¼Œæ”€ç™»æ–°çš„å±±å³°å§ï¼

## é™„å½•ï¼šmain.dart å®Œæ•´ä»£ç ï¼š

```
import 'package:flutter/material.dart';
import 'package:flutter_juejin_yiyan/ui/page/home_page.dart';
void main() {
  runApp(const MyApp());
}
class MyApp extends StatefulWidget {
  const MyApp({super.key});
  @override
  State<MyApp> createState() => _MyAppState();
}
class _MyAppState extends State<MyApp> with WidgetsBindingObserver {
  bool darkModeOn = false;
  bool customTheme = false;
  @override
  void initState() {
    super.initState();
    WidgetsBinding.instance.addObserver(this);
  }
  @override
  void dispose() {
    WidgetsBinding.instance.removeObserver(this);
    super.dispose();
  }
  @override
  void didChangePlatformBrightness() {
    Brightness brightness = WidgetsBinding.instance.window.platformBrightness;
    if (!customTheme) {
      setState(() {
        if (brightness.name == "light") {
          darkModeOn = false;
        } else {
          darkModeOn = true;
        }
      });
    }
  }
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      theme: ThemeData(
          fontFamily: 'ShuYunSong',
          brightness: customTheme && !darkModeOn
              ? Brightness.light
              : customTheme && darkModeOn
                  ? Brightness.dark
                  : Brightness.light),
      darkTheme: ThemeData(
          fontFamily: 'ShuYunSong',
          brightness: customTheme && !darkModeOn
              ? Brightness.light
              : customTheme && darkModeOn
                  ? Brightness.dark
                  : Brightness.dark),
      home: Scaffold(
        body: Stack(children: [
          const HomePage(),
          Positioned(
            right: 20,
            top: 40,
            child: SizedBox(
              width: 30,
              height: 30,
              child: MaterialButton(
                padding: const EdgeInsets.all(0),
                child: Icon(
                    darkModeOn ? Icons.dark_mode_outlined : Icons.dark_mode,
                    size: 25),
                onPressed: () {
                  setState(() {
                    customTheme = true;
                    darkModeOn = !darkModeOn;
                  });
                },
              ),
            ),
          )
        ]),
      ),
    );
  }
}
```